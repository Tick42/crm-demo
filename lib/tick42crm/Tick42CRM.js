!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("tick42-crm",[],t):"object"==typeof exports?exports["tick42-crm"]=t():e.Tick42CRM=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,n){var r,o;!function(i,s){r=s,(o="function"==typeof r?r.call(t,n,t,e):r)!==undefined&&(e.exports=o)}(this,function(){function e(e,t){return t instanceof e}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e}function r(e){return e&&n(e)&&Object.getPrototypeOf(e)===Object.prototype}function o(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1]}function i(e){return Array.prototype.slice.call(e)}function s(e,t){return t===undefined?e:t}function c(e,t,n,o){for(var i in t||{})if(o||t.hasOwnProperty(i))if(n&&r(t[i])){var s={};c(s,e[i],n),c(s,t[i],n),e[i]=s}else e[i]=t[i]}function u(e,t,n,r){$(e,t,{value:n,enumerable:r,writable:!0,configurable:!0})}function a(e,t){Object.setPrototypeOf(e,t[V]),u(e,G,t)}function d(e,t){e[V]=Object.create(t),e[V][G]=e}function f(r,o){if(o=o||[],o.length>15||o.indexOf(r)>=0)return"...";if(null==r)return String(r);if("string"==typeof r)return'"'+r+'"';if(e(l,r))return r.toString(o);if(o=[r].concat(o),t(r))return r.name||r.toString(o);if(e(Array,r))return"["+r.map(function(e){return f(e,o)}).join(", ")+"]";if(r.toString!==Object.prototype.toString)return r.toString();if(r&&n(r)){var i=new Array(o.length).join("\t"),s=Object.keys(r);return"{"+s.map(function(e){return"\n"+i+"\t"+e+": "+f(r[e],o)}).join(",")+(s.length?"\n"+i:"")+"}"}return String(r)}function l(e){if(r(e))return l[j](e);var t=function(e){return e=s(t[K],e),t[C](e),e};return p(t,arguments,l),t}function p(e,t,n){if(0===t.length)throw new Error("Model definition is required");a(e,n),e[E]=t[0],e[O]=e[O].slice(),u(e,U,[])}function m(t){if(r(t))Object.keys(t).forEach(function(e){t[e]=m(t[e])});else{if(!e(Array,t))return[t];if(1===t.length)return t.concat(undefined,null)}return t}function h(t,n,o,i,s,c){var u=i.indexOf(n);if(u!==-1&&i.slice(u+1).indexOf(n)!==-1)return t;if(c&&(t=v(t,n)),e(l,n))n[k](t,o,i.concat(n),s);else if(r(n))Object.keys(n).forEach(function(e){h(null!=t?t[e]:undefined,n[e],o?o+"."+e:e,i,s)});else{for(var a=m(n),d=0,f=a.length;d<f;d++)if(g(t,a[d],o,i))return t;var p={};p[D]=n,p[F]=t,p[q]=o,s.push(p)}return t}function g(n,o,i,s){if(null==n)return n===o;if(r(o)||e(l,o)){var c=[];return h(n,o,i,s,c),!c.length}return e(RegExp,o)?o.test(n):o===Number||o===Date?n[G]===o&&!isNaN(n):n===o||t(o)&&e(o,n)||n[G]===o}function y(e,n,r,o){for(var i=0,s=n[O].length;i<s;i++){var c,u=n[O][i],a=u[N],d=t(a)?a:function(e,t){return'assertion "'+a+'" returned '+f(e)+" for value "+f(t)};try{c=u.call(n,e)}catch(e){c=e}if(c!==!0){var l={};l[L]=d.call(n,c,e),l[D]=u,l[F]=e,l[q]=r,o.push(l)}}}function v(t,n){if(!t||e(l,t[G]))return t;for(var r=m(n||[]),o=[],i=0,s=r.length;i<s;i++){var c=r[i];e(l,c)&&c[R](t)&&o.push(c)}var u=o.length;return 1===u?o[0](t):(u>1&&console.warn("Ambiguous model for value "+f(t)+", could be "+o.join(" or ")),t)}function b(t,n,o,i){if(!r(o))return v(n,o);var s=e(Object,n)?n:{},c=Object.create(Object.getPrototypeOf(s));for(var u in s)!s.hasOwnProperty(u)||u in o||(c[u]=s[u]);return Object.keys(o).forEach(function(u){var a=i?i+"."+u:u,d=l[I](u),f=o[u];r(f)||!s[u]||e(l,s[u][G])||(s[u]=v(s[u],f)),$(c,u,{get:function(){return b(t,s[u],f,a)},set:function(e){if(d&&s[u]!==undefined){var r={};r[L]="cannot redefine constant "+u,t[U].push(r)}var o=b(t,e,f,a);h(o,f,a,[],t[U]);var i=s[u];s[u]=o,y(n,t,a,t[U]),t[U].length&&(s[u]=i,t[J]())},enumerable:!l[A](u)})}),c}function S(e,t,n,r){$(e,n,{enumerable:!0,get:function(){return t[n]},set:function(e){w(t,n,e,r)}})}function _(e,t,n,r){return function(){var o=e.slice();if(Array[V][t].apply(o,arguments),n[C](o),!Z)for(var i in o)!o.hasOwnProperty(i)||i in r||S(r,e,i,n);for(var s=Array[V][t].apply(e,arguments),c=0,u=e.length;c<u;c++)e[c]=v(e[c],n[E]);return s}}function w(e,t,n,r){var o=M+"["+t+"]";parseInt(t)===+t&&t>=0&&(n=h(n,r[E],o,[],r[U],!0));var i=e.slice();i[t]=n,y(i,r,o,r[U]),r[J](),e[t]=n}var j="Object",M="Array",T="Function",I="conventionForConstant",A="conventionForPrivate",E="definition",O="assertions",N="_description",C="validate",k="_validator",R="test",x="extend",P="assert",D="expected",F="received",q="path",L="message",U="errorStack",B="errorCollector",J="unstack",V="prototype",G="constructor",K="default",H="defaultTo",X="defaults",W="return",Y="arguments",z=["pop","push","reverse","shift","sort","splice","unshift"],Q=/\n.*object-model(.|\n)*object-model.*/,Z="function"==typeof Proxy,$=Object.defineProperty;"name"in Function.prototype&&"name"in function(){}||$(Function.prototype,"name",{get:function(){var e=Function.prototype.toString.call(this).match(/\s*function\s+([^\(\s]*)\s*/);return e&&e[1]}}),!Object.setPrototypeOf&&e(Array,{__proto__:[]})&&(Object.setPrototypeOf=function(e,t){return e.__proto__=t,e}),d(l,Function[V]);var ee=l[V];ee.toString=function(e){return m(this[E]).map(function(t){return f(t,e)}).join(" or ")},ee[O]=[],ee[C]=function(e,t){this[k](e,null,[],this[U]),this[J](t)},ee[R]=function(e){var t,n=this[B];return this[B]=function(){t=!0},this(e),this[B]=n,!t},ee[x]=function(){var r,o,s=i(this[O]),u=i(arguments);e(l[j],this)?(r={},o={},c(r,this[E]),c(o,this[V],!1,!0),u.forEach(function(i){e(l,i)&&c(r,i[E],!0),t(i)&&c(o,i[V],!0,!0),n(i)&&c(r,i,!0,!0)}),delete o.constructor):r=u.reduce(function(e,t){return e.concat(m(t))},m(this[E])).filter(function(e,t,n){return n.indexOf(e)===t}),u.forEach(function(t){e(l,t)&&(s=s.concat(t[O]))});var a=new this[G](r);return d(a,this[V]),c(a[V],o),a[O]=s,a[B]=this[B],a},ee[P]=function(e,t){return t=t||f(e),u(e,N,t),this[O]=this[O].concat(e),this},ee[H]=function(e){return this[K]=e,this},ee[B]=function(e){var t=new TypeError(e.map(function(e){return e[L]}).join("\n"));throw t.stack&&(t.stack=t.stack.replace(Q,"")),t},l[I]=function(e){return e.toUpperCase()===e},l[A]=function(e){return"_"===e[0]},u(ee,k,function(e,t,n,r){h(e,this[E],t,n,r),y(e,this,t,r)}),u(ee,J,function(t){if(this[U].length){t||(t=this[B]);var n=this[U].map(function(t){if(!t[L]){var n=e(Array,t[D])?t[D]:[t[D]];t[L]="expecting "+(t[q]?t[q]+" to be ":"")+n.map(function(e){return f(e)}).join(" or ")+", got "+(null!=t[F]?o(t[F])+" ":"")+f(t[F])}return t});this[U]=[],t.call(this,n)}}),l[j]=function(t){var n=function(t){if(e(n,t))return t;if(!e(n,this))return new n(t);t=s(n[K],t),c(this,t,!0);var r=b(n,this,n[E]);return n[C](r),r};return d(n,Object[V]),p(n,arguments,l[j]),n},d(l[j],ee);var te=l[j][V];te[X]=function(e){return c(this[V],e),this},te.toString=function(e){return f(this[E],e)},u(te,k,function(e,t,r,o){if(n(e))h(e,this[E],t,r,o);else{var i={};i[D]=this,i[F]=e,i[q]=t,o.push(i)}y(e,this,t,o)}),l[M]=function(e){var t=function(e){e=s(t[K],e);var n;if(t[C](e),Z)n=new Proxy(e,{get:function(e,n){return n===G?t:z.indexOf(n)>=0?_(e,n,t):e[n]},set:function(e,n,r){w(e,n,r,t)},getPrototypeOf:function(){return t[V]}});else{n=Object.create(Array[V]);for(var r in e)e.hasOwnProperty(r)&&S(n,e,r,t);$(n,"length",{get:function(){return e.length}}),$(n,"toJSON",{value:function(){return e}}),z.forEach(function(r){u(n,r,_(e,r,t,n))}),a(n,t)}return n};return d(t,Array[V]),p(t,arguments,l[M]),t},d(l[M],l[V]);var ne=l[M][V];ne.toString=function(e){return M+" of "+f(this[E],e)},u(ne,k,function(t,n,r,o){if(e(Array,t))for(var i=0,s=t.length;i<s;i++)t[i]=h(t[i],this[E],(n||M)+"["+i+"]",r,o,!0);else{var c={};c[D]=this,c[F]=t,c[q]=n,o.push(c)}y(t,this,n,o)}),l[T]=function(){var e=function(t){t=s(e[K],t);var n=e[E],r=function(){var r,o=[];if(c(o,n[X]),c(o,i(arguments)),o.length>n[Y].length){var s={};s[D]=f(t)+" to be called with "+n[Y].length+" "+Y,s[F]=o.length,e[U].push(s)}return n[Y].forEach(function(t,n){o[n]=h(o[n],t,Y+"["+n+"]",[],e[U],!0)}),y(o,e,Y,e[U]),e[U].length||(r=t.apply(this,o),W in n&&(r=h(r,n[W],W+" value",[],e[U],!0))),e[J](),r};return a(r,e),r};d(e,Function[V]);var t={};return t[Y]=i(arguments),p(e,[t],l[T]),e},d(l[T],l[V]);var re=l[T][V];return re.toString=function(e){var t=T+"("+this[E][Y].map(function(t){return f(t,e)}).join(",")+")";return W in this[E]&&(t+=" => "+f(this[E][W])),t},re[W]=function(e){return this[E][W]=e,this},re[X]=function(){return this[E][X]=i(arguments),this},u(re,k,function(e,n,r,o){if(!t(e)){var i={};i[D]=T,i[F]=e,i[q]=n,o.push(i)}}),l})},function(e,t,n){var r=n(0),o=n(4),i=n(17),s=n(3),c=n(5);e.exports=r({ids:r.Array(o),displayName:[String],name:[i],status:[String],isPerson:[Boolean],account:[o],addresses:[r.Array(s)],phones:[r.Array(c)],emails:[r.Array(String)]})},function(e,t){e.exports={CRM_PREFIX:"T42.CRM.",SIGNATURES:{CONTACT:"Composite { Composite { String? city, String? country, String? description, String? postalCode, String? stateOrRegion, String? streetAddress }[]? addresses, String? displayName, String[]? emails, Bool? isPerson, Composite { String? companyName, String? firstName, String? honorific, String? lastName, String[]? otherNames, String[]? postNominalLetters }? name, Composite { String name, String number }[]? phones, String? status } contact",ACCOUNT:"Composite { Composite { String? city, String? country, String? description, String? postalCode, String? stateOrRegion, String? streetAddress }[]? addresses, String? billingEmailAddress, Composite { String nativeId, String systemName }[]? contacts, String? displayName, String[]? emailDomains, Composite { String nativeId, String systemName }[] ids, String? name, Composite { String nativeId, String systemName }? owner, Composite { String name, String number }[]? phones, String? status, Composite { String nativeId, String systemName }[]? subsidiaries, String[]? website } account",CONTACTS:"Composite { Composite { String? city, String? country, String? description, String? postalCode, String? stateOrRegion, String? streetAddress }[]? addresses, String? displayName, String[]? emails, Bool? isPerson, Composite { String? companyName, String? firstName, String? honorific, String? lastName, String[]? otherNames, String[]? postNominalLetters }? name, Composite { String name, String number }[]? phones, String? status }[] contacts"}}},function(e,t,n){var r=n(0);e.exports=r({streetAddress:[String],city:[String],stateOrRegion:[String],postalCode:[String],country:[String],description:[String]})},function(e,t,n){var r=n(0);e.exports=r({nativeId:String,systemName:String})},function(e,t,n){var r=n(0);e.exports=r({number:String,name:String})},function(e,t){e.exports={side:"crm",glue:{gateway:{ws:"wss://demo.tick42.com:50112",http:"https://demo.tick42.com:50112",protocolVersion:2}},timeout:3e3}},function(e,t,n){function r(e,t){var r=n(10)(e,t),i=n(9)(e,t),u=o(t.side),a=c(e,t);return{GetContact:r.get,CreateContact:r.create,ResolveContact:r.resolve,UpdateContact:r.update,DeleteContact:r["delete"],SyncContact:r.sync,LogContactCall:r.logCall,CreateAccount:i.create,GetAccount:i.get,ResolveAccount:i.resolve,UpdateAccount:i.update,DeleteAccount:i["delete"],SyncAccount:i.sync,QueryAccount:function(e){return a.search("T42.Account",e)},QueryContact:function(e){return a.search("T42.Contact",e)},ResolveAccountContactList:i.resolveContactList,on:function(t,n){var r=u.find(function(e){return e.name===s.CRM_PREFIX+t});if(!r)throw new Error("Unsupported method: "+t);e.registerAsync(r,n)},onSearch:a.addEntityType}}function o(e){return i.filter(function(t){return"both"===t.side||t.side===e})}var i=n(15),s=n(2),c=n(14);e.exports=r},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=43)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(){function e(e,t){var r=n[e];return r||(r=[],n[e]=r),r.push(t),function(){var r=n[e];r=r.filter(function(e){return e!==t}),n[e]=r}}function t(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var i=[];return o.forEach(function(e){try{var n=e.apply(undefined,t);i.push(n)}catch(e){i.push(undefined)}}),i}var n={};return{add:e,execute:t}}r["default"]=r,e.exports=r},function(e,t,n){var r=n(7);e.exports=function(){"use strict";return r()}},function(e,t){function n(e){"use strict";return"object"!=typeof e&&(e={}),{application:e.ApplicationName,environment:e.Environment,machine:e.MachineName,pid:e.ProcessId,region:e.Region,service:e.ServiceName,user:e.UserName,started:e.ProcessStartTime}}function r(e){"use strict";if("number"!=typeof e||isNaN(e))return!1;var t=32;return(e&t)===t}e.exports={isStreamingFlagSet:r,convertInfoToInstance:n}},function(e,t,n){"use strict";function r(){l=!1}function o(e){if(!e)return void(d!==m&&(d=m,r()));if(e!==d){if(e.length!==m.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. These characters were not unique: "+t.join(", "));d=e,r()}}function i(e){return o(e),d}function s(e){p.seed(e),f!==e&&(r(),f=e)}function c(){d||o(m);for(var e,t=d.split(""),n=[],r=p.nextValue();t.length>0;)r=p.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function u(){return l?l:l=c()}function a(e){return u()[e]}var d,f,l,p=n(17),m="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={characters:i,seed:s,lookup:a,shuffled:u}},function(e,t){e.exports=function(e,t,n){"use strict";if("function"!=typeof t&&"function"!=typeof n)return e;"function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n)}},function(e,t){e.exports={_from:"tick42-agm@3.5.10",_id:"tick42-agm@3.5.10",_inBundle:!1,_integrity:"sha1-oJsRPWiE730kK+SYY8rD1CjjfLs=",_location:"/tick42-agm",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"tick42-agm@3.5.10",name:"tick42-agm",escapedName:"tick42-agm",rawSpec:"3.5.10",saveSpec:null,fetchSpec:"3.5.10"},_requiredBy:["#USER","/"],_resolved:"http://repo.tick42.com:8081/artifactory/api/npm/tick42-npm/tick42-agm/-/tick42-agm-3.5.10.tgz",_shasum:"a09b113d6884ef7d242be49863cac3d428e37cbb",_spec:"tick42-agm@3.5.10",_where:"D:\\work\\stash\\GLUE-dev\\dev\\node_modules\\tick42-glue-core",author:{name:"Tick42",url:"http://www.tick42.com"},bundleDependencies:!1,dependencies:{"callback-registry":"^2.2.7",shortid:"^2.2.6","util-deprecate":"^1.0.2"},deprecated:!1,description:"JavaScript AGM",devDependencies:{"babel-core":"^6.25.0","babel-loader":"^6.2.5","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-es6-promise":"^1.0.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0",blanket:"^1.1.6",bluebird:"^2.9.30",docdash:"^0.4.0",eslint:"^3.1.1","eslint-config-standard":"^5.3.5","eslint-config-tick42":"^1.0.6","eslint-plugin-promise":"^2.0.0","eslint-plugin-standard":"^2.0.0","http-server":"^0.9.0",minifyify:"^7.3.2",onchange:"^2.1.2",phantomjs:"^1.9.12","pre-commit":"^1.1.3",qunitjs:"^1.15.0",shelljs:"^0.6.0","tick42-webpack-config":"^1.3.1",webpack:"2.3.3"},keywords:["agm","javascript","library"],main:"src/main.js",name:"tick42-agm",precommit:"eslint",scripts:{build:"npm run eslint && webpack",eslint:"eslint library","eslint:fix":"eslint library --fix","generate-docs":"jsdoc -c jsdoc-config.json",prepublish:"npm update & npm run build",serve:"http-server -p 8000 -a 127.0.0.1",test:'npm run eslint && mocha --require ./test/test_helper "test/**/*.js"',watch:'onchange "./library/**/*.js" -iv -e "./bin" -- npm run build',"watch-docs":'onchange "./library/*.js" -iv -e "./bin" -- npm run generate-docs'},title:"Tick42 AGM",types:"types/index.d.ts",version:"3.5.10"}},function(e,t,n){"use strict";e.exports=n(14)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(40),o=n(38),i=n(39),s=n(27),c=n(41),u=n(42),a=n(44),d=n(9),f=function(e,t){function n(e,t,n){t.initStartTime=n.startTime,t.ready?t.ready().then(function(){t.initTime=n.stop(),t.initEndTime=n.endTime}):(t.initTime=n.stop(),t.initEndTime=n.endTime),A[e]=t}function f(){var e=a["default"]();return T.connection.logger=w.subLogger("connection"),S=o["default"](T.connection),T.connection&&!T.auth&&T.connection.protocolVersion>1&&d.Promise.reject("You need to provide auth information"),T.auth?new d.Promise(function(t,r){var o;if("string"==typeof T.auth||"number"==typeof T.auth)o={token:T.auth};else{if("[object Object]"!==Object.prototype.toString.call(T.auth))throw new Error("Invalid auth object - "+JSON.stringify(T.auth));o=T.auth}S.login(o).then(function(r){r&&(r.machine&&(T.agm.instance.machine=r.machine),r.username&&(T.agm.instance.user=r.username)),n("connection",S,e),t(T)})["catch"](function(e){r(e)})}):(n("connection",S,e),d.Promise.resolve({}))}function l(){var e=a["default"](),t={identity:T.metrics.identity,getConnection:function(){return S||u["default"]},publish:T.logger.publish||"off",console:T.logger.console||"info",metrics:T.logger.metrics||"off"};return w=i["default"](t),n("logger",w,e),d.Promise.resolve(undefined)}function p(){var e=a["default"]();return j=r["default"]({identity:T.metrics.identity,connection:T.metrics?S:u["default"],logger:w.subLogger("metrics")}),M=j.subSystem("App"),w.metricsLevel("warn",M.parent.subSystem("LogEvents")),n("metrics",M,e),d.Promise.resolve(undefined)}function m(){var e=a["default"](),t={instance:T.agm.instance,connection:S,metrics:j.subSystem("AGM"),logger:w.subLogger("agm")};return new d.Promise(function(r,o){s["default"](t).then(function(t){_=t,n("agm",_,e),r(T)})["catch"](function(e){return o(e)})})}function h(e){try{return e.forEach(function(e){g(e.name,e.create)}),d.Promise.resolve()}catch(e){return d.Promise.reject(e)}}function g(e,t){var r=a["default"](),o=t(A);o&&n(e,o,r)}function y(){var e=Object.keys(A).map(function(e){var t=A[e];return t.ready?t.ready():d.Promise.resolve()});return d.Promise.all(e)}function v(){var n=function(){_&&_.invoke("T42.ACS.Feedback",{},"best")},r={glueVersion:T.version};b.stop();var o={feedback:n,info:r,version:T.version,userConfig:e};if(o.performance={get browser(){return window.performance.timing},get memory(){return window.performance.memory},get initTimes(){var e=Object.keys(o).filter(function(e){return"initTimes"!==e&&o[e].initTime}).map(function(e){return{name:e,time:o[e].initTime,startTime:o[e].initStartTime,endTime:o[e].initEndTime}});return e.push({name:"glue",startTime:b.startTime,endTime:b.endTime,time:b.period}),e}},Object.keys(A).forEach(function(e){var t=A[e];o[e]=t,r[e]=t.version}),I&&I.perfDataNeeded&&I.updatePerfData){var i=I.perfDataDelay||100;setTimeout(function(){I.updatePerfData(o.performance)},i)}return o.config={},t.enrichGlue&&t.enrichGlue(o),Object.keys(T).forEach(function(e){o.config[e]=T[e]}),t.extOptions&&Object.keys(t.extOptions).forEach(function(e){o.config[e]=t.extOptions[e]}),o}var b=a["default"]();e=e||{},t=t||{};var S,_,w,j,M,T=c["default"](e,t),I="undefined"!=typeof window&&window.htmlContainer,A={};return l().then(f).then(p).then(m).then(function(){return h(T.libs||[])}).then(y).then(v)["catch"](function(e){return d.Promise.reject({err:e,libs:A})})};t["default"]=f},function(e,t,n){(function(t,r){!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){Y=e}function s(e){z=e}function c(){return function(){return t.nextTick(l)}}function u(){return void 0!==W?function(){W(l)}:f()}function a(){var e=0,t=new $(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<X;e+=2){(0,ne[e])(ne[e+1]),ne[e]=undefined,ne[e+1]=undefined}X=0}function p(){try{var e=n(45);return W=e.runOnLoop||e.runOnContext,u()}catch(e){return f()}}function m(e,t){var n=arguments,r=this,o=new this.constructor(g);o[oe]===undefined&&P(o);var i=r._state;return i?function(){var e=n[i-1];z(function(){return k(i,o,e,r._result)})}():E(r,o,e,t),o}function h(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(g);return M(n,e),n}function g(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function b(e){try{return e.then}catch(e){return ue.error=e,ue}}function S(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function _(e,t,n){z(function(e){var r=!1,o=S(n,t,function(n){r||(r=!0,t!==n?M(e,n):I(e,n))},function(t){r||(r=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,A(e,o))},e)}function w(e,t){t._state===se?I(e,t._result):t._state===ce?A(e,t._result):E(t,undefined,function(t){return M(e,t)},function(t){return A(e,t)})}function j(e,t,n){t.constructor===e.constructor&&n===m&&t.constructor.resolve===h?w(e,t):n===ue?(A(e,ue.error),ue.error=null):n===undefined?I(e,t):o(n)?_(e,t,n):I(e,t)}function M(t,n){t===n?A(t,y()):e(n)?j(t,n,b(n)):I(t,n)}function T(e){e._onerror&&e._onerror(e._result),O(e)}function I(e,t){e._state===ie&&(e._result=t,e._state=se,0!==e._subscribers.length&&z(O,e))}function A(e,t){e._state===ie&&(e._state=ce,e._result=t,z(T,e))}function E(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+se]=n,o[i+ce]=r,0===i&&e._state&&z(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=undefined,o=undefined,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?k(n,r,o,i):o(i);e._subscribers.length=0}}function N(){this.error=null}function C(e,t){try{return e(t)}catch(e){return ae.error=e,ae}}function k(e,t,n,r){var i=o(n),s=undefined,c=undefined,u=undefined,a=undefined;if(i){if(s=C(n,r),s===ae?(a=!0,c=s.error,s.error=null):u=!0,t===s)return void A(t,v())}else s=r,u=!0;t._state!==ie||(i&&u?M(t,s):a?A(t,c):e===se?I(t,s):e===ce&&A(t,s))}function R(e,t){try{t(function(t){M(e,t)},function(t){A(e,t)})}catch(t){A(e,t)}}function x(){return de++}function P(e){e[oe]=de++,e._state=undefined,e._result=undefined,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(g),this.promise[oe]||P(this.promise),H(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&I(this.promise,this._result))):A(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function q(e){return new D(this,e).promise}function L(e){var t=this;return new t(H(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function U(e){var t=this,n=new t(g);return A(n,e),n}function B(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function V(e){this[oe]=x(),this._result=this._state=undefined,this._subscribers=[],g!==e&&("function"!=typeof e&&B(),this instanceof V?R(this,e):J())}function G(){var e=undefined;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=V}var K=undefined;K=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=K,X=0,W=undefined,Y=undefined,z=function(e,t){ne[X]=e,ne[X+1]=t,2===(X+=2)&&(Y?Y(l):re())},Q="undefined"!=typeof window?window:undefined,Z=Q||{},$=Z.MutationObserver||Z.WebKitMutationObserver,ee="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=undefined;re=ee?c():$?a():te?d():Q===undefined?p():f();var oe=Math.random().toString(36).substring(16),ie=void 0,se=1,ce=2,ue=new N,ae=new N,de=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ie&&n<e;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===h){var o=b(e);if(o===m&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===V){var i=new n(g);j(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ie&&(this._remaining--,e===ce?A(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;E(e,undefined,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ce,t,e)})},V.all=q,V.race=L,V.resolve=h,V.reject=U,V._setScheduler=i,V._setAsap=s,V._asap=z,V.prototype={constructor:V,then:m,catch:function(e){return this.then(null,e)}},V.polyfill=G,V.Promise=V,V})}).call(t,n(11),n(0))},function(e,t){e.exports={name:"tick42-glue-core",version:"3.3.3",description:"Glue42 core library including logger, connection, agm and metrics",main:"./dist/node/tick42-glue-core.js",types:"./glue.d.ts",browser:"./dist/web/tick42-glue-core.js",scripts:{"init-dev-mode":"node ./build/scripts/init-dev-mode.js","remove-installed-dependencies":"node ./build/scripts/remove-installed-dependencies.js",clean:"node ./build/scripts/clean.js","pre:build":"npm run tslint && tsc && set NODE_ENV=development && npm run clean","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/main.ts","tslint:fix":"tslint -t codeFrame --fix ./src/main.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify && npm run types","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify",docs:"typedoc --options typedoc.json ./src",prepublish:"npm run build:prod && npm run test:only",types:"node ./build/scripts/copy-types.js",test:"npm run build:dev && mocha ./tests","test:only":"mocha ./tests"},repository:{type:"git",url:"https://stash.tick42.com/scm/tg/js-glue-core.git"},author:{name:"Tick42",url:"http://www.glue42.com"},license:"ISC",dependencies:{shortid:"2.2.6","tick42-agm":"^3.5.10","tick42-gateway-connection":"2.2.10","tick42-logger":"^3.0.8","tick42-metrics":"^2.3.4"},devDependencies:{"@types/es6-promise":"0.0.32","@types/shortid":"0.0.29",archiver:"^1.3.0","babel-core":"^6.25.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-es6-promise":"^1.0.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0",chai:"^4.0.2","es6-promise":"^4.1.0",mocha:"^2.5.3",onchange:"3.*","pre-commit":"^1.1.3","readline-sync":"^1.4.5",shelljs:"^0.6.0","tick42-gateway":"^0.2.28","tick42-webpack-config":"4.1.6",tslint:"^5.4.3",typedoc:"^0.5.10",typescript:"2.3.0",webpack:"2.3.3"}}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){h&&p&&(h=!1,p.length?m=p.concat(m):g=-1,m.length&&c())}function c(){if(!h){var e=o(s);h=!0;for(var t=m.length;t;){for(p=m,m=[];++g<t;)p&&p[g].run();g=-1,t=m.length}p=null,h=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function a(){}var d,f,l=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var p,m=[],h=!1,g=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||h||o(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,n){"use strict";function r(e){var t=o.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var o=n(4);e.exports=r},function(e,t,n){"use strict";function r(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|o()),n=t<Math.pow(16,r+1),r++;return i}var o=n(16);e.exports=r},function(e,t,n){"use strict";function r(){var e="",t=Math.floor(.001*(Date.now()-p));return t===u?c++:(c=0,u=t),e+=d(a.lookup,m),e+=d(a.lookup,h),c>0&&(e+=d(a.lookup,c)),e+=d(a.lookup,t)}function o(t){return a.seed(t),e.exports}function i(t){return h=t,e.exports}function s(e){return e!==undefined&&a.characters(e),a.shuffled()}var c,u,a=n(4),d=n(13),f=n(12),l=n(15),p=1459707606518,m=6,h=n(18)||0;e.exports=r,e.exports.generate=r,e.exports.seed=o,e.exports.worker=i,e.exports.characters=s,e.exports.decode=f,e.exports.isValid=l},function(e,t,n){"use strict";function r(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=o.characters(),n=e.length,r=0;r<n;r++)if(t.indexOf(e[r])===-1)return!1;return!0}var o=n(4);e.exports=r},function(e,t,n){"use strict";function r(){if(!o||!o.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return o.getRandomValues(e),48&e[0]}var o="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=r},function(e,t,n){"use strict";function r(){return(i=(9301*i+49297)%233280)/233280}function o(e){i=e}var i=1;e.exports={nextValue:r,seed:o}},function(e,t,n){"use strict";e.exports=0},function(e,t,n){var r=n(2);e.exports=function(e){"use strict";function t(t,o,i,s,c,u){var a=r();n(a,{method:t,calledWith:o},c,u,s.method_response_timeout),e.invoke(a,t,o,i,s)}function n(e,t,n,r,o){i[e]={response:t,success:n,error:r},setTimeout(function(){i[e]!==undefined&&(r({method:t.method,called_with:t.calledWith,message:"Timeout reached"}),delete i[e])},o)}function o(e,t,n,r,o){var s=i[e];s!==undefined&&(0===n&&"function"==typeof s.success?s.success({method:s.response.method.info,called_with:s.response.calledWith,executed_by:t,returned:r,message:o}):"function"==typeof s.error&&s.error({method:s.response.method.info,called_with:s.response.calledWith,executed_by:t,message:o,status:n,returned:r}),delete i[e])}var i={};return e.onInvocationResult(o),{invoke:t}}},function(e,t,n){(function(t){var r=n(19),o=n(5);e.exports=function(e,n,i,s){"use strict";function c(e){return e===undefined?n.getMethods():("string"==typeof e&&(e={name:e}),n.getMethods().filter(function(t){return g(e,t.info)}))}function u(e){var t=n.getServers(),r=t.filter(function(t){return h(e,t.info)});if(0===r.length)return[];var o={};return 1===r.length?o=r[0].methods:r.forEach(function(e){Object.keys(e.methods).forEach(function(t){var n=e.methods[t];o[n.id]=n.getInfoForUser()})}),Object.keys(o).map(function(e){return o[e]})}function a(e){var t=n.getServers();return e===undefined?t.map(function(e){return{server:e}}):c(e)===undefined?[]:t.reduce(function(t,r){var o=n.getServerMethodsById(r.id),i=o.filter(function(t){return g(e,t.info)});return i.length>0&&t.push({server:r,methods:i}),t},[])}function d(e,t){return m(t,a(e))}function f(e,t,n,r,i,c){return o(new Promise(function(o,i){var c,u;c=function(e){o(e)},u=function(e){i(e)},t||(t={}),n||(n="best"),"string"==typeof n&&"all"!==n&&"best"!==n&&i({message:'"'+n+'" is not a valid target. Valid targets are "all" and "best".'}),r||(r={}),r.method_response_timeout===undefined&&(r.method_response_timeout=s.method_response_timeout),r.waitTimeoutMs===undefined&&r.wait_for_method_timeout!==undefined&&(r.waitTimeoutMs=r.wait_for_method_timeout),r.waitTimeoutMs!==undefined&&"number"!=typeof r.waitTimeoutMs&&i({message:'"'+r.waitTimeoutMs+"\" is not a valid number for 'waitTimeoutMs'"}),r.waitTimeoutMs===undefined&&(r.waitTimeoutMs=s.wait_for_method_timeout),"object"!=typeof t&&i({message:"The method arguments must be an object."}),"string"==typeof e&&(e={name:e});var a=d(e,n);if(0===a.length)l(e,t,n,r,c,u);else if(1===a.length){var f=a[0];b.invoke(f.methods[0],t,f.server,r,c,u)}else p(a,t,r,c,u)}),i,c)}function l(e,t,n,r,o,i){function s(){i({method:e,called_with:t,message:"Can not find a method matching "+JSON.stringify(e)+" with server filter "+JSON.stringify(n)})}if(0===r.waitTimeoutMs)s();else{var c=500,u=0;setTimeout(function a(){u+=c,d(e,n).length>0?f(e,t,n,r,o,i):u>=r.waitTimeoutMs?s():setTimeout(a,c)},c)}}function p(e,t,n,r,o){function i(){if(!(s.length+c.length<e.length))if(0!==s.length){var t=s.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.returned=t.returned,e.all_return_values.push({executed_by:t.executed_by,returned:t.returned}),e.executed_by=t.executed_by,e},{all_return_values:[]});0!==c.length&&(t.all_errors=[],c.forEach(function(e){t.all_errors.push({name:e.method.name,message:e.message})})),r(t)}else 0!==c.length&&o(c.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.message=t.message,e.all_errors.push({executed_by:t.executed_by,message:t.message}),e},{all_errors:[]}))}var s=[],c=[],u=function(e){s.push(e),i(s,c)},a=function(e){c.push(e),i(s,c)};e.forEach(function(e){b.invoke(e.methods[0],t,e.server,n,u,a)})}function m(e,t){return"string"==typeof e?"all"===e?e=t:"best"===e&&(e=t[0]!==undefined?[t[0]]:[]):(Array.isArray(e)||(e=[e]),e=e.reduce(function(e,n){var r=t.filter(function(e){return h(n,e.server.info)});return e.concat(r)},[])),e}function h(e,t){return y(e,t)}function g(e,t){return y(e,t)}function y(e,t){return Object.keys(e).reduce(function(n,r){return e[r]?e[r].constructor===RegExp?!!e[r].test(t[r])&&n:String(e[r]).toLowerCase()===String(t[r]).toLowerCase()&&n:n},!0)}function v(n,r,i,c){function u(r,o,i,c,u){t.console!==undefined&&s.debug===!0&&console.log('>>> Subscribing to "'+n+'" on '+r.length+" servers"),e.subscribe(o,i.arguments,r,{method_response_timeout:i.waitTimeoutMs},c,u)}return o(new Promise(function(e,t){var o=function(t){e(t)},i=function(e){t(e)};r===undefined&&(r={});var c=r.target;c===undefined&&(c="best"),"string"==typeof c&&"all"!==c&&"best"!==c&&t({message:'"'+c+'" is not a valid target. Valid targets are "all", "best", or an instance.'}),"number"==typeof r.waitTimeoutMs&&r.waitTimeoutMs===r.waitTimeoutMs||(r.waitTimeoutMs=s.wait_for_method_timeout);var a=500,f=0,l=d({name:n},c);l.length>0?u(l,l[0].methods[0],r,o,i):setTimeout(function e(){f+=a;var t=d({name:n},c);if(t.length>0){u(t,t[0].methods[0],r,o,i)}else f>=r.waitTimeoutMs?u(t,{name:n},r,o,i):setTimeout(e,a)},a)}),i,c)}var b=new r(e);return{subscribe:v,invoke:f,servers:function(e){return a(e).map(function(e){return e.server.getInfoForUser()})},methods:function(e){return c(e).map(function(e){return e.getInfoForUser()})},methodsForInstance:function(e){return u(e).map(function(e){return e.getInfoForUser()})},methodAdded:function(e){n.onMethodAdded(function(t){e(t.getInfoForUser())})},methodRemoved:function(e){n.onMethodRemoved(function(t){e(t.getInfoForUser())})},serverAdded:function(e){n.onServerAdded(function(t){e(t.getInfoForUser())})},serverRemoved:function(e){n.onServerRemoved(function(t,n){e(t.getInfoForUser(),n)})},serverMethodAdded:function(e){n.onServerMethodAdded(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})},serverMethodRemoved:function(e){n.onServerMethodRemoved(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})}}}}).call(t,n(0))},function(e,t,n){(function(t){var r=t.document||t.process,o=n(2);e.exports=function(e){"use strict";function t(e){c||(s.MachineName===undefined&&(s.MachineName=e.MachineName),s.UserName===undefined&&(s.UserName=e.UserName),s.Environment===undefined&&(s.Environment=e.Environment),s.Region===undefined&&(s.Region=e.Region),s.State===undefined&&(s.State=e.State),c=!0)}function n(e){return s[e]}function i(){return s}var s={};s.ApplicationName=r.title+o(),s.ProcessId=Math.floor(1e10*Math.random()),s.ProcessStartTime=(new Date).getTime(),"object"==typeof e&&(e.application!==undefined&&(s.ApplicationName=e.application),s.MachineName=e.machine,s.UserName=e.user,s.Environment=e.environment,s.Region=e.region,s.State=1);var c=!1;return{_updateIdentity:t,info:i,get application(){return n("ApplicationName")},get pid(){return n("ProcessId")},get user(){return n("UserName")},get machine(){return n("MachineName")}}}}).call(t,n(0))},function(e,t,n){(function(t){var r=n(5),o=n(6);e.exports=function(e){"use strict";function n(e,t){if("string"==typeof e){var n={};return n[t]=e,n}return e}function i(e){return JSON.parse(e,function(e,t){if("string"!=typeof t)return t;if(t[0]!==d[0])return t;if(0!==t.indexOf(d))return t;var n=t.substr(f);return new Date(parseFloat(n))})}function s(e){if("string"==typeof(e=e||"best")){if("all"!==e&&"best"!==e)throw new Error('"'+e+'" is not a valid target. Valid targets are "all" and "best".');return{target:e}}return Array.isArray(e)||(e=[e]),e=e.map(function(e){return c(e)}),{serverFilter:e}}function c(e){var t={};return Object.keys(e).forEach(function(n){var r=e[n];t[n]=r,void 0!==r&&null!==r&&("string"==typeof r&&""!==r?t[n]="^"+e[n]+"$":e[n].constructor===RegExp?t[n]=e[n].source:t[n]=e[n])}),t}function u(e){if(void 0===e)throw Error("methodInfo is required argument");if(!e.name)throw Error("methodInfo object must contain name property");e.objectTypes&&(e.object_types=e.objectTypes),e.displayName&&(e.display_name=e.displayName)}var a=t.htmlContainer.jsAgmFacade,d=a.jsonValueDatePrefix,f=d.length;return new Promise(function(t,c){var d={version:o.version,register:function(e,t){var r=n(e,"name");u(r);var o=this.agmFacade.protocolVersion;o&&o>=3?this.agmFacade.register(JSON.stringify(r),t,!0):this.agmFacade.register(JSON.stringify(r),function(e){var n=t(JSON.parse(e),arguments[1]);return JSON.stringify(n)})},registerAsync:function(e,t){if(!this.agmFacade.registerAsync)throw new Error("not supported in that version of HtmlContainer");var r=n(e,"name");u(r),this.agmFacade.registerAsync(r,function(e,n,r){t(e,n,function(e){r.success(e)},function(e){r.error(e)})})},unregister:function(e){this.agmFacade.unregister(JSON.stringify(n(e,"name")))},invoke:function(e,t,o,i,c,u){return r(new Promise(function(r,c){if(t===undefined&&(t={}),"object"!=typeof t&&c({message:"The method arguments must be an object."}),i===undefined&&(i={}),o=s(o),this.agmFacade.invoke2)this.agmFacade.invoke2(JSON.stringify(n(e,"name")),t,JSON.stringify(o),JSON.stringify(i),function(e){r(e)},function(e){c(e)});else{var u,a;u=function(e){r(JSON.parse(e))},a=function(e){c(JSON.parse(e))},this.agmFacade.invoke(JSON.stringify(n(e,"name")),JSON.stringify(t),JSON.stringify(o),JSON.stringify(i),u,a)}}.bind(this)),c,u)},methodAdded:function(e){this.agmFacade.methodAdded(e)},methodRemoved:function(e){this.agmFacade.methodRemoved(e)},serverAdded:function(e){this.agmFacade.serverAdded(e)},serverRemoved:function(e){this.agmFacade.serverRemoved(e)},serverMethodAdded:function(e){this.agmFacade.serverMethodAdded(e)},serverMethodRemoved:function(e){this.agmFacade.serverMethodRemoved(e)},servers:function(e){var t=this.agmFacade.servers(JSON.stringify(n(e,"name"))),r=i(t);return r.forEach(function(e){e.getMethods=function(){return this.methodsForInstance(e)}.bind(this),e.getStreams=function(){return this.methodsForInstance(e).filter(function(e){return e.supportsStreaming})}.bind(this)},this),r},methods:function(e){var t=this.agmFacade.methods(JSON.stringify(n(e,"name"))),r=i(t);return r.forEach(function(e){e.displayName=e.display_name,e.objectTypes=e.object_types,e.getServers=function(){return this.servers(e.name)}.bind(this)},this),r},methodsForInstance:function(e){return i(this.agmFacade.methodsForInstance(JSON.stringify(e)))},subscribe:function(e,t,n,o){return r(new Promise(function(n,r){t===undefined&&(t={}),t.args=JSON.stringify(t.arguments||{}),t.target=s(t.target),this.agmFacade.subscribe2(e,JSON.stringify(t),function(e){n(e)},function(e){r(e)})}.bind(this)),n,o)},createStream:function(e,t,n,o){return r(new Promise(function(n,r){"string"==typeof e&&(e={name:e}),t||(t={}),this.agmFacade.createStream2(JSON.stringify(e),t.subscriptionRequestHandler,t.subscriptionAddedHandler,t.subscriptionRemovedHandler,function(e){n(e)},function(e){r(e)})}.bind(this)),n,o)}};if(e!==undefined&&e.metrics!==undefined){e.metrics.metricsIdentity=e.metrics.identity;var f={metricsIdentity:e.metrics.metricsIdentity,path:e.metrics.path};e.metrics=f}delete e.logger;var l=function(e){d.instance=e,d.agmFacade=a,d.create_stream=d.createStream,d.methods_for_instance=d.methodsForInstance,d.method_added=d.methodAdded,d.method_removed=d.methodRemoved,d.server_added=d.serverAdded,d.server_removed=d.serverRemoved,d.server_method_added=d.serverMethodAdded,d.server_method_removed=d.serverMethodRemoved,t(d)},p=JSON.stringify(e),m=a.protocolVersion;if(m&&m>=5&&a.initAsync)a.initAsync(p,l,function(e){c(e)});else{l(a.init(p))}})}}).call(t,n(0))},function(e,t,n){var r=n(1);e.exports=function(){"use strict";function e(e,t){var n=y[t];if(n)return n.id;var r={id:t,info:e,methods:{}};return r.getInfoForUser=function(){var e=m(r.info);return e.getMethods=function(){return a(r.id).map(function(e){return e.getInfoForUser()})},e.getStreams=function(){var e=a(r.id);return e=e.filter(function(e){return e.supportsStreaming}),e.map(function(e){return e.getInfoForUser()})},e},y[t]=r,b.execute("onServerAdded",r),t}function t(e,t){var n=y[e];Object.keys(n.methods).forEach(function(t){i(e,t)}),delete y[e],b.execute("onServerRemoved",n,t)}function n(e,t){var n=y[e];if(!n)throw new Error("server does not exists");var r=o(t);if(!n.methods[r]){var i={id:r,info:t};i.getInfoForUser=function(){var e=h(i.info);return e.getServers=function(){return s(this.id)}.bind(this),e},n.methods[r]=i,v[r]||(v[r]=0,b.execute("onMethodAdded",i)),v[r]=v[r]+1,b.execute("onServerMethodAdded",n,i)}}function o(e){var t=e.accepts!==undefined?e.accepts:"",n=e.returns!==undefined?e.returns:"",r=e.version!==undefined?e.version:0;return(e.name+t+n+r).toLowerCase()}function i(e,t){var n=y[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t],v[t]=v[t]-1,0===v[t]&&b.execute("onMethodRemoved",r),b.execute("onServerMethodRemoved",n,r)}function s(e){var t=[];return Object.keys(y).forEach(function(n){var r=y[n];Object.keys(r.methods).forEach(function(n){n===e&&t.push(r.getInfoForUser())})}),t}function c(){var e={};return Object.keys(y).forEach(function(t){var n=y[t];Object.keys(n.methods).forEach(function(t){var r=n.methods[t];e[r.id]=r})}),Object.keys(e).map(function(t){return e[t]})}function u(){var e=[];return Object.keys(y).forEach(function(t){var n=y[t];e.push(n)}),e}function a(e){var t=y[e];return Object.keys(t.methods).map(function(e){return t.methods[e]})}function d(e){b.add("onServerAdded",e),u().forEach(function(t){e(t)})}function f(e){b.add("onMethodAdded",e),c().forEach(function(t){e(t)})}function l(e){b.add("onServerMethodAdded",e),u().forEach(function(t){var n=t.methods;Object.keys(n).forEach(function(r){e(t,n[r])})})}function p(e){return y[e]}function m(e){return{machine:e.machine,pid:e.pid,user:e.user,application:e.application,environment:e.environment,region:e.region,instance:e.instance}}function h(e){return{name:e.name,accepts:e.accepts,returns:e.returns,description:e.description,displayName:e.displayName,display_name:e.displayName,version:e.version,objectTypes:e.objectTypes,object_types:e.objectTypes,supportsStreaming:e.supportsStreaming}}function g(){y={},v={}}var y={},v={},b=new r;return{getServerById:p,getServers:u,getMethods:c,getServerMethodsById:a,getMethodId:o,addServer:e,addServerMethod:n,removeServerById:t,removeServerMethod:i,onServerAdded:d,onServerRemoved:function(e){b.add("onServerRemoved",e)},onMethodAdded:f,onMethodRemoved:function(e){b.add("onMethodRemoved",e)},onServerMethodAdded:l,onServerMethodRemoved:function(e){b.add("onServerMethodRemoved",e)},reset:g}}},function(e,t){e.exports=function(e,t){"use strict";function n(n){var i=n.definition;return{branches:function(){return e.getBranchList(n).map(function(e){return o(n,e)})},close:function(){e.closeAllSubscriptions(n),t(n.definition)},definition:{accepts:i.accepts,description:i.description,displayName:i.displayName,name:i.name,objectTypes:i.objectTypes,returns:i.returns,supportsStreaming:i.supportsStreaming},name:i.name,push:function(t,r){if("string"!=typeof r&&!Array.isArray(r)&&r!==undefined)throw new Error("invalid branches should be string or string array");if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");e.pushData(n,t,r)},subscriptions:function(){return e.getSubscriptionList(n).map(function(e){return r(n,e)})}}}function r(t,n){return{arguments:n.arguments||{},branchKey:n.branchKey,close:function(){e.closeSingleSubscription(t,n)},instance:n.instance,push:function(r){e.pushDataToSingle(t,n,r)},stream:t.definition}}function o(t,n){return{key:n,subscriptions:function(){return e.getSubscriptionList(t,n).map(function(e){return r(t,e)})},close:function(){e.closeAllSubscriptions(t,n)},push:function(r){e.pushToBranch(t,r,n)}}}return e.onSubRequest(function(t,n){n&&n.streamCallbacks&&"function"==typeof n.streamCallbacks.subscriptionRequestHandler&&n.streamCallbacks.subscriptionRequestHandler({accept:function(){e.acceptRequestOnBranch(t,n,"")},acceptOnBranch:function(r){e.acceptRequestOnBranch(t,n,r)},arguments:t.arguments,instance:t.instance,reject:function(r){e.rejectRequest(t,n,r)}})}),e.onSubAdded(function(e,t){t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler&&t.streamCallbacks.subscriptionAddedHandler(r(t,e))}),e.onSubRemoved(function(e,t){t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler&&t.streamCallbacks.subscriptionRemovedHandler(e)}),{streamFrontObj:n}}},function(e,t){e.exports=function(){"use strict";function e(e){if("object"==typeof e&&e._repoId===undefined)return e._repoId=String(s),s+=1,c.push(e),e}function t(e){if("string"!=typeof e)return new TypeError("Expecting a string");c=c.filter(function(t){return t._repoId!==e})}function n(e){return"string"!=typeof e?new TypeError("Expecting a string"):c.filter(function(t){return t._repoId===e})[0]}function r(){return c.map(function(e){return e})}function o(){return c.length}function i(){c=[]}var s=0,c=[];return{add:e,remove:t,getById:n,getList:r,length:o,reset:i}}},function(e,t,n){var r=n(5),o=n(24);e.exports=function(e,t,n,i){"use strict";function s(t,n,r){p("Invocations count",h++),t&&t.theFunction(r,function(r,o){r&&("string"==typeof r.message?r=r.message:"string"!=typeof r&&(r="")),o&&"object"==typeof o&&o.constructor!==Array||(o={_result:o}),e.methodInvocationResult(t,n,r,o)})}function c(e,t){var n=function(e,n){try{n(null,t(e.args,e.instance))}catch(e){n(e,e)}};n.userCallback=t,d(e,n)}function u(e,t){var n=function(e,n){try{t(e.args,e.instance,function(e){n(null,e)},function(e){n(e,e)})}catch(e){n(e,null)}};n.userCallback=t,n.isAsync=!0,d(e,n)}function a(n,o,i,s){return new r(new Promise(function(r,i){"string"==typeof n&&(""===n&&i("Invalid stream name."),n={name:n}),n.supportsStreaming=!0,o||(o={}),"function"!=typeof o.subscriptionRequestHandler&&(o.subscriptionRequestHandler=function(e){e.accept()});var s={method:undefined,definition:n,streamCallbacks:o};t.add(s),e.createStream(s,n,function(){p("Registered methods",t.length()),r(m.streamFrontObj(s))},function(e){t.remove(s._repoId),i(e)})}),i,s)}function d(n,r){"string"==typeof n&&(n={name:n});var o=t.add({definition:n,theFunction:r});e.register(o,function(){p("Registered methods",t.length())},function(){t.remove(o._repoId)})}function f(e,t){var n=!0;return Object.keys(e).forEach(function(r){e[r]!==t[r]&&(n=!1)}),n}function l(n){"string"==typeof n&&(n={name:n}),t.getList().filter(function(e){return f(n,e.definition)}).forEach(function(n){t.remove(n._repoId),e.unregister(n)}),p("Registered methods",t.length())}var p=i.metrics!==undefined?i.metrics.numberMetric.bind(i.metrics):function(){},m=new o(e,l);e.onInvoked(s);var h=0;return{register:c,registerAsync:u,unregister:l,createStream:a}}},function(e,t,n){(function(t){var r=n(21),o=n(22),i=n(6),s=n(20),c=n(26),u=n(30),a=n(35),d=n(23),f=n(25),l=function(e){"use strict";var t={};t.version=i.version,"object"!=typeof e&&(e={}),["connection","client","server"].forEach(function(t){"object"!=typeof e[t]&&(e[t]={}),e.debug&&(e[t].debug=!0)}),"number"!=typeof e.client.remove_server_on_n_missing_heartbeats&&(e.client.remove_server_on_n_missing_heartbeats=3),"number"!=typeof e.client.method_response_timeout&&(e.client.method_response_timeout=3e3),"number"!=typeof e.client.wait_for_method_timeout&&(e.client.wait_for_method_timeout=3e3),"number"!=typeof e.server.heartbeat_interval&&(e.server.heartbeat_interval=5e3),"number"!=typeof e.server.presence_interval&&(e.server.presence_interval=1e4);var n=e.connection;if(!n)throw new Error("configuration.connection is required");t.connection=n;var o="agm";t.connection.sendAGM=function(e,n){t.connection.send(o,e,n)},t.connection.onAGM=function(e,n){t.connection.on(o,e,n)};var l=e.metrics;l!==undefined&&(e.client.metrics=l.subSystem("Client"),e.server.metrics=l.subSystem("Server")),t.instance=r(e.instance);var p,m=d(),h=f();if(3===n.protocolVersion){var g=function(){return t.server},y=function(){return t.client};p=a(t.instance,t.connection,m,h,e,g,y)}else p=u(t.instance,t.connection,m,h,e);return new Promise(function(n,r){p.then(function(r){t.client=s(r,m,t.instance,e.client),t.server=c(r,h,t.instance,e.server),t.invoke=t.client.invoke,t.register=t.server.register,t.registerAsync=t.server.registerAsync,t.unregister=t.server.unregister,t.createStream=t.server.createStream,t.subscribe=t.client.subscribe,t.servers=t.client.servers,t.methods=t.client.methods,t.methodsForInstance=t.client.methodsForInstance,t.method=t.client.method,t.methodAdded=t.client.methodAdded,t.methodRemoved=t.client.methodRemoved,t.serverMethodAdded=t.client.serverMethodAdded,t.serverMethodRemoved=t.client.serverMethodRemoved,t.serverAdded=t.client.serverAdded,t.serverRemoved=t.client.serverRemoved,n(t)})["catch"](function(e){r(e)})})};l=t.htmlContainer!==undefined?o:l,l["default"]=l,e.exports=l}).call(t,n(0))},function(e,t,n){(function(t){var r=n(2),o=n(3);e.exports=function(e,n,i,s){"use strict";function c(o,c,a,d,f,l){if(0===a.length)return void l(y+" No available servers matched the target params.");var p="subscriptionId_"+r(),m=u(p,o,c,f,l,d.method_response_timeout);if("object"!=typeof m)return void l(y+" Unable to register the user callbacks.");a.forEach(function(r){var u=s();m.trackedServers.push({server:undefined,streamId:undefined,streamSubjects:{global:undefined,private:undefined},methodRequestSubject:o.info.requestSubject,methodResponseSubject:u});var a={EventStreamAction:1,MethodRequestSubject:o.info.requestSubject,MethodResponseSubject:u,Client:n.info(),Context:{ArgumentsJson:c,InvocationId:p,ObjectType:d.object_type,DisplayContext:d.display_context,MethodName:o.info.name,ExecutionServer:r.server.info,Timeout:d.method_response_timeout}};i(a),t.console!==undefined&&e.debug===!0&&(console.debug("%c>>> sending MethodInvocationRequestMessage","background-color:hsla(198, 51%, 79%, 0.5)"),console.debug("%c"+JSON.stringify(a),"background-color:hsla(198, 51%, 79%, 0.5)"))})}function u(e,t,n,r,o,i){return _[e]={status:h,method:t,arguments:n,success:r,error:o,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:undefined},_[e].timeoutId=setTimeout(function(){if(_[e]!==undefined){var r=_[e];if(r.status===h)o({method:t,called_with:n,message:y+" Subscription attempt timed out after "+i+"ms."}),delete _[e];else if(r.status===g&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter(function(e){return"string"==typeof e.streamId&&""!==e.streamId}),r.timeoutId=undefined,0===r.trackedServers.length)){var s=r.queued.closers.length,c=s>0?r.queued.closers[s-1]:null;r.handlers.onClosed.forEach(function(e){"function"==typeof e&&e({message:b,requestArguments:r.arguments,server:c,stream:r.method})}),delete _[e]}}},i),_[e]}function a(e){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(2===e.EventStreamAction?d(e):3===e.EventStreamAction?f(e):5===e.EventStreamAction&&l(e))}function d(e){var t=Object.keys(_);"string"==typeof e.InvocationId&&""!==e.InvocationId&&(t=t.filter(function(t){return t===e.InvocationId}));var n=[];t.forEach(function(t){"object"==typeof _[t]&&(_[t].trackedServers=_[t].trackedServers.filter(function(t){var n=t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject,r=t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects["private"]===e.EventStreamSubject);return!(n||r)}),0===_[t].trackedServers.length&&n.push(t))}),n.forEach(function(t){if("object"==typeof _[t]){if(_[t].status===h&&"number"==typeof _[t].timeoutId){var n="string"==typeof e.ResultMessage&&""!==e.ResultMessage?' Publisher said "'+e.ResultMessage+'".':" No reason given.",r="object"==typeof _[t].arguments?JSON.stringify(_[t].arguments):"{}";_[t].error(v+n+" Called with:"+r),clearTimeout(_[t].timeoutId)}else _[t].handlers.onClosed.forEach(function(n){"function"==typeof n&&n({message:b,requestArguments:_[t].arguments,server:o.convertInfoToInstance(e.Server),stream:_[t].method})});delete _[t]}})}function f(e){var t=e.InvocationId,r=_[t];if("object"==typeof r){var s=r.trackedServers.filter(function(t){return t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject})[0];if("object"==typeof s){var c=r.status===h;r.status=g;var u=m(r.method.name);if("string"!=typeof s.streamId||""===s.streamId){s.server=o.convertInfoToInstance(e.Server),s.streamId=e.StreamId,s.streamSubjects.global=e.EventStreamSubject,s.streamSubjects["private"]=u;i({EventStreamAction:3,EventStreamSubject:u,StreamId:e.StreamId,MethodRequestSubject:e.MethodRequestSubject,MethodResponseSubject:s.methodResponseSubject,Client:n.info(),Context:{ArgumentsJson:r.arguments,MethodName:r.method.name}}),c&&r.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.handlers.onData.push(e),1===this.handlers.onData.length&&this.queued.data.length>0&&this.queued.data.forEach(function(t){e(t)})}.bind(r),onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.handlers.onClosed.push(e)}.bind(r),onFailed:function(){},close:p.bind(r,t),requestArguments:r.arguments,serverInstance:o.convertInfoToInstance(e.Server),stream:r.method})}}}}function l(e){for(var t in _)if(_.hasOwnProperty(t)&&"object"==typeof _[t]){var n,r=_[t].trackedServers.filter(function(t){return t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects["private"]===e.EventStreamSubject)});if(0===r.length?n=undefined:r[0].streamSubjects.global===e.EventStreamSubject?n=!1:r[0].streamSubjects["private"]===e.EventStreamSubject&&(n=!0),n!==undefined){var i={data:e.ResultContextJson,server:o.convertInfoToInstance(e.Server),requestArguments:_[t].arguments||{},message:e.ResultMessage,private:n},s=_[t].handlers.onData,c=_[t].queued.data;Array.isArray(s)&&(s.length>0?s.forEach(function(e){"function"==typeof e&&e(i)}):c.push(i))}}}function p(e){var t=s();this.trackedServers.forEach(function(e){i({EventStreamAction:2,Client:n.info(),MethodRequestSubject:e.methodRequestSubject,MethodResponseSubject:t,StreamId:e.streamId,EventStreamSubject:e.streamSubjects["private"]})});var r=this;this.handlers.onClosed.forEach(function(e){"function"==typeof e&&e({message:S,requestArguments:r.arguments||{},server:r.trackedServers[r.trackedServers.length-1].server,stream:r.method})}),delete _[e]}function m(e){return"ESSpriv-jsb_"+n.info().ApplicationName+"_on_"+e+"_"+r()}var h="awaitingAccept",g="subscribed",y="Subscription failed.",v="Subscription rejected.",b="ServerInitiated",S="ClientInitiated",_={};return{subscribe:c,processPublisherMsg:a}}}).call(t,n(0))},function(e,t,n){var r=n(2),o=n(1),i=n(28),s=n(3);e.exports=function(e,t,n,c){"use strict";function u(){return"resp_"+S+++"_"+r()}function a(e){return{machine:e.MachineName,pid:e.ProcessId,started:e.ProcessStartTime,user:e.UserName,application:e.ApplicationName,environment:e.Environment,region:e.Region,service_name:e.ServiceName,metrics_repository_id:e.MetricsRepositoryId,state:e.State}}function d(e){var t=e.Method;return{name:t.Name,accepts:t.InputSignature,returns:t.ResultSignature,requestSubject:e.MethodRequestSubject,description:t.Description,displayName:t.DisplayName,version:t.Version,objectTypes:t.ObjectTypeRestrictions,supportsStreaming:s.isStreamingFlagSet(t.Flags)}}function f(e){return e===undefined?undefined:[e.application,e.user,e.machine,e.started,e.pid].join("/").toLowerCase()}function l(e,t){var n=e.Instance,r=a(n),o=f(r);if(t)o=c.addServer(r,o),e.PublishingInterval&&p(o,e.PublishingInterval);else if(0===e.PublishingInterval){var i=c.getServerById(o);void 0!==i&&c.removeServerById(o)}e.MethodDefinitions!==undefined&&m(o,e.MethodDefinitions)}function p(e,t){if(t!==-1){var r=b[e];r!==undefined&&clearTimeout(r),b[e]=setTimeout(function(){c.removeServerById(e)},t*(n.client.remove_server_on_n_missing_heartbeats+1))}}function m(e,t){var n=c.getServerMethodsById(e);t=t.map(d).reduce(function(e,t){return e[c.getMethodId(t)]=t,e},{}),Object.keys(n).forEach(function(r){var o=n[r];t[o.id]===undefined?c.removeServerMethod(e,o.id):delete t[o.id]}),Object.keys(t).forEach(function(n){var r=t[n];c.addServerMethod(e,r)})}function h(n,r,o,i,s){var c=r.info,a={MethodRequestSubject:c.requestSubject,MethodResponseSubject:u(),Client:t.info(),Context:{ArgumentsJson:o,InvocationId:n,ObjectType:s.object_type,DisplayContext:s.display_context,MethodName:c.name,ExecutionServer:i.info,Timeout:s.method_response_timeout}};e.sendAGM("MethodInvocationRequestMessage",a)}function g(e){if(e&&e.EventStreamAction&&0!==e.EventStreamAction)return void w.processPublisherMsg(e);var t=e.Server?a(e.Server):undefined,n=e.ResultContextJson;n&&0===Object.keys(n).length&&(n=undefined),_.execute("onResult",e.InvocationId,t,e.Status,n,e.ResultMessage)}function y(e){_.add("onResult",e)}function v(){e.onAGM("ServerPresenceMessage",function(e){l(e,!0)}),e.onAGM("ServerHeartbeatMessage",function(e){l(e,!1)}),e.onAGM("MethodInvocationResultMessage",g)}var b={},S=0,_=o(),w=new i(n,t,function(t){e.sendAGM("MethodInvocationRequestMessage",t)},u);return v(),{invoke:h,onInvocationResult:y,subscribe:w.subscribe}}},function(e,t,n){var r=n(32),o=n(29);e.exports=function(e,t,n,i,s){"use strict";t.onAGM("Instance",e._updateIdentity);var c=new r(t,e,s,i),u=new o(t,e,s,n);return new Promise(function(e){e({invoke:u.invoke,onInvocationResult:u.onInvocationResult,register:c.register,unregister:c.unregister,onInvoked:c.onInvoked,methodInvocationResult:c.methodInvocationResult,subscribe:u.subscribe,createStream:c.createStream,getBranchList:c.getBranchList,getSubscriptionList:c.getSubscriptionList,closeAllSubscriptions:c.closeAllSubscriptions,closeSingleSubscription:c.closeSingleSubscription,pushData:c.pushData,pushDataToSingle:c.pushDataToSingle,onSubRequest:c.onSubRequest,acceptRequestOnBranch:c.acceptRequestOnBranch,rejectRequest:c.rejectRequest,onSubAdded:c.onSubAdded,onSubRemoved:c.onSubRemoved})})}},function(e,t,n){var r=n(2),o=n(3);e.exports=function(e,t){"use strict";function n(t){if("object"!=typeof t)throw new Error("Invalid message.");"number"!=typeof t.Status&&(t.Status=0),e.sendAGM("MethodInvocationResultMessage",t)}function i(e,t){return e&&e.EventStreamAction&&0!==e.EventStreamAction&&"object"==typeof t&&t.definition.supportsStreaming===!0}function s(e,t){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(1===e.EventStreamAction?c(e,t):2===e.EventStreamAction?u(e,t):3===e.EventStreamAction?a(e,t):4===e.EventStreamAction&&d(e))}function c(e,t){var n={msg:e,arguments:e.Context.ArgumentsJson||{},instance:o.convertInfoToInstance(e.Client)};"function"==typeof A&&A(n,t)}function u(e,t){t&&Array.isArray(t.subscriptions)&&t.subscriptions.length>0&&g(t,e.StreamId,e.EventStreamSubject,!1)}function a(e,t){if("string"==typeof e.StreamId&&""!==e.StreamId){var n=l(t,e.StreamId);if("string"==typeof n&&Array.isArray(t.subscriptions)){var r={branchKey:n,instance:o.convertInfoToInstance(e.Client),arguments:e.Context.ArgumentsJson,streamId:e.StreamId,privateEventStreamSubject:e.EventStreamSubject,methodResponseSubject:e.MethodResponseSubject};t.subscriptions.push(r),"function"==typeof E&&E(r,t)}}}function d(){}function f(e,r,o){"string"!=typeof o&&(o="");var i=p(r,o),s=e.msg;n({EventStreamAction:3,EventStreamSubject:r.globalEventStreamSubject,InvocationId:s.Context.InvocationId,MethodName:r.method.Method.Name,MethodRequestSubject:r.method.MethodRequestSubject,MethodResponseSubject:s.MethodResponseSubject,MethodVersion:r.method.Method.Version,ResultMessage:"Accepted",Server:t.info(),StreamId:i})}function l(e,t){if("string"==typeof t&&"object"==typeof e){var n=e.branchKeyToStreamIdMap.filter(function(e){return e.streamId===t})[0];if("object"==typeof n&&"string"==typeof n.key)return n.key}}function p(e,t){"string"!=typeof t&&(t="");var n=e.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],r=n?n.streamId:undefined;return"string"==typeof r&&""!==r||(r=m(e.method.Method.Name),e.branchKeyToStreamIdMap.push({key:t,streamId:r})),r}function m(e){return"streamId-jsb_of_"+e+"__by_"+t.info().ApplicationName+"_"+r()}function h(e,r,o){"string"!=typeof o&&(o="");var i=e.msg;n({EventStreamAction:2,EventStreamSubject:r.globalEventStreamSubject,MethodName:r.method.Method.Name,MethodRequestSubject:r.method.MethodRequestSubject,MethodResponseSubject:i.MethodResponseSubject,MethodVersion:r.method.Method.Version,ResultMessage:o,Server:t.info(),StreamId:"default_rejection_streamId"})}function g(e,r,o,i){var s=e.subscriptions.filter(function(e){return e.privateEventStreamSubject===o&&e.streamId===r})[0];if("object"==typeof s){var c=e.subscriptions.length;e.subscriptions=e.subscriptions.filter(function(e){return!(e.privateEventStreamSubject===s.privateEventStreamSubject&&e.streamId===s.streamId)});e.subscriptions.length===c-1&&(i===!0&&n({EventStreamAction:2,EventStreamSubject:o,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,MethodResponseSubject:s.methodResponseSubject,MethodVersion:e.method.Method.Version,ResponseContextJson:{},Server:t.info(),StreamId:s.streamId,Status:0}),"function"==typeof O&&O(s,e))}}function y(e,r){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){var o=e.branchKeyToStreamIdMap;"string"==typeof r&&(o=e.branchKeyToStreamIdMap.filter(function(e){return"object"==typeof e&&e.key===r})),o.forEach(function(r){var o=r.streamId;n({EventStreamAction:2,EventStreamSubject:e.globalEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,Server:t.info(),StreamId:o,Status:0})})}}function v(e,t){g(e,t.streamId,t.privateEventStreamSubject,!0)}function b(e,r,o){if("object"!=typeof o)throw new Error("Invalid arguments. Data must be an object.");n({EventStreamAction:5,EventStreamSubject:r.privateEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,ResultContextJson:o,Server:t.info(),StreamId:r.streamId})}function S(e,r,o){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){if("object"!=typeof r)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof o?o=[o]:(!Array.isArray(o)||o.length<=0)&&(o=null);e.branchKeyToStreamIdMap.filter(function(e){return null===o||Boolean(e)&&"string"==typeof e.key&&o.indexOf(e.key)>=0}).map(function(e){return e.streamId}).forEach(function(o){n({EventStreamAction:5,EventStreamSubject:e.globalEventStreamSubject,MethodName:e.method.Method.Name,MethodRequestSubject:e.method.MethodRequestSubject,ResultContextJson:r,Server:t.info(),StreamId:o})})}}function _(e,t){if("object"!=typeof e)return[];return"string"!=typeof t?e.subscriptions:e.subscriptions.filter(function(e){return e.branchKey===t})}function w(e){return"object"!=typeof e?[]:j(e)}function j(e){var t=e.subscriptions.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),n=[];return t.filter(function(e){return!(null===e||n.indexOf(e)>=0)&&(n.push(e),!0)})}function M(e){"function"==typeof e&&(A=e)}function T(e){"function"==typeof e&&(E=e)}function I(e){"function"==typeof e&&(O=e)}var A=null,E=null,O=null;return{isStreamMsg:i,processSubscriberMsg:s,pushData:S,pushDataToSingle:b,closeAllSubscriptions:y,closeSingleSubscription:v,getSubscriptionList:_,getBranchList:w,onSubRequest:M,acceptRequestOnBranch:f,rejectRequest:h,onSubAdded:T,onSubRemoved:I,generateNewStreamId:m}}},function(e,t,n){var r=n(2),o=n(1),i=n(31),s=n(3);e.exports=function(e,t,n,c){"use strict";function u(){return"req_"+M+++"_"+r()}function a(){return{PublishingInterval:n.server.heartbeat_interval,Instance:t.info()}}function d(){var e=c.getList();return{PublishingInterval:n.server.presence_interval,Instance:t.info(),MethodDefinitions:e.map(function(e){return e.method})}}function f(){e.sendAGM("ServerPresenceMessage",d())}function l(){e.sendAGM("ServerHeartbeatMessage",a())}function p(e,t){return"string"==typeof e&&(e={name:e}),"number"!=typeof e.version&&(e.version=0),{Method:{Name:e.name,InputSignature:e.accepts,ResultSignature:e.returns,Description:e.description,DisplayName:e.displayName,Version:e.version,ObjectTypeRestrictions:e.objectTypes},MethodRequestSubject:t}}function m(e,t){var n=u();e.method=p(e.definition,n),g(),t()}function h(e,t,n){var o=u(),i=p(t,o);i.Method.Flags=32,e.method=i,e.globalEventStreamSubject=t.name+".jsStream."+r(),e.subscriptions=[],e.branchKeyToStreamIdMap=[],g(),n()}function g(){f(),_===undefined&&(_=setInterval(f,n.server.presence_interval))}function y(e){var t=e.MethodRequestSubject,n=c.getList(),r=n.filter(function(e){return e.method.MethodRequestSubject===t})[0];if(r!==undefined){if(I.isStreamMsg(e,r))return void I.processSubscriberMsg(e,r);var o=e.Context.InvocationId;j[o]=e;var i={args:e.Context.ArgumentsJson,instance:s.convertInfoToInstance(e.Client)};T.execute("onInvoked",r,o,i)}}function v(e){T.add("onInvoked",e)}function b(n,r,o,i){var s=j[r];if(s&&"null"!==s.MethodResponseSubject&&n!==undefined){var c={MethodRequestSubject:s.MethodRequestSubject,MethodResponseSubject:s.MethodResponseSubject,MethodName:n.method.Method.Name,InvocationId:r,ResultContextJson:i,Server:t.info(),ResultMessage:o,Status:o?1:0};e.sendAGM("MethodInvocationResultMessage",c),delete j[r]}}function S(){f()}var _,w,j={},M=0,T=o(),I=new i(e,t);return e.onAGM("MethodInvocationRequestMessage",y),l(),w===undefined&&(w=setInterval(l,n.server.heartbeat_interval)),{register:m,onInvoked:v,methodInvocationResult:b,unregister:S,createStream:h,getBranchList:I.getBranchList,getSubscriptionList:I.getSubscriptionList,closeAllSubscriptions:I.closeAllSubscriptions,closeSingleSubscription:I.closeSingleSubscription,pushDataToSingle:I.pushDataToSingle,pushData:I.pushData,onSubRequest:I.onSubRequest,acceptRequestOnBranch:I.acceptRequestOnBranch,rejectRequest:I.rejectRequest,onSubAdded:I.onSubAdded,onSubRemoved:I.onSubRemoved}}},function(e,t){e.exports=function(e,t,n,r){"use strict";function o(){var e=w;return w+=1,e}function i(e,n,i,a,d,f){if(0===i.length)return void f(g+" No available servers matched the target params.");r.debug("subscribe to target servers: ",i);var l=o(),m=s(l,e,n,d,f,a.method_response_timeout);if("object"!=typeof m)return void f(g+" Unable to register the user callbacks.");i.forEach(function(r){var o=r.server.id;m.trackedServers.push({serverId:o,subscriptionId:undefined});var i={type:p,server_id:o,method_id:e.info.id,arguments_kv:n};t.send(i,{serverId:o,subLocalKey:l}).then(u)["catch"](c)})}function s(e,t,n,r,o,i){return S[e]={status:m,method:t,arguments:n,success:r,error:o,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:undefined},S[e].timeoutId=setTimeout(function(){if(S[e]!==undefined){var r=S[e];r.status===m?(o({method:t,called_with:n,message:g+" Subscription attempt timed out after "+i+"ms."}),delete S[e]):r.status===h&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter(function(e){return"undefined"!=typeof e.subscriptionId}),delete r.timeoutId,r.trackedServers.length<=0&&(f(r),delete S[e]))}},i),S[e]}function c(e){r.debug("Subscription attempt failed",e);var t=e._tag,n=t.subLocalKey,o=S[n];if("object"==typeof o&&(o.trackedServers=o.trackedServers.filter(function(e){return e.serverId!==t.serverId}),o.trackedServers.length<=0)){if(clearTimeout(o.timeoutId),o.status===m){var i="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",s="object"==typeof o.arguments?JSON.stringify(o.arguments):"{}";o.error(y+i+" Called with:"+s)}else o.status===h&&f(o);delete S[n]}}function u(e){r.debug("handleSubscribed",e);var t=e._tag.subLocalKey,o=S[t];if("object"==typeof o){var i=e._tag.serverId,s=o.trackedServers.filter(function(e){return e.serverId===i})[0];if("object"==typeof s){s.subscriptionId=e.subscription_id,_[e.subscription_id]=t;var c=o.status===m;o.status=h,c&&o.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.handlers.onData.push(e),1===this.handlers.onData.length&&this.queued.data.length>0&&this.queued.data.forEach(function(t){e(t)})}.bind(o),onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.handlers.onClosed.push(e)}.bind(o),onFailed:function(){},close:l.bind(null,t),requestArguments:o.arguments,serverInstance:n.getServerById(i).getInfoForUser(),stream:o.method})}}}function a(e){function t(){return{data:e.data,server:n.getServerById(u).getInfoForUser(),requestArguments:i.arguments||{},message:null,private:c}}r.debug("handleEventData",e);var o=_[e.subscription_id];if(void 0!==o){var i=S[o];if("object"==typeof i){var s=i.trackedServers.filter(function(t){return t.subscriptionId===e.subscription_id});if(1===s.length){var c=e.oob&&e.snapshot,u=s[0].serverId,a=i.handlers.onData,d=i.queued.data;a.length>0?a.forEach(function(e){"function"==typeof e&&e(t())}):d.push(t())}}}}function d(e){r.debug("handleSubscriptionCancelled",e);var t=_[e.subscription_id];if(void 0!==t){var n=S[t];if("object"==typeof n){var o=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter(function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)}),n.trackedServers.length===o&&(n.trackedServers.length<=0&&(clearTimeout(n.timeoutId),f(n),delete S[t]),delete _[e.subscription_id])}}}function f(e,t){var r=e.queued.closers.length,o=r>0?e.queued.closers[r-1]:null,i=null;"number"==typeof o&&(i=n.getServerById(o).getInfoForUser()),e.handlers.onClosed.forEach(function(n){"function"==typeof n&&n({message:t||v,requestArguments:e.arguments,server:i,stream:e.method})})}function l(e){r.debug("closeSubscription",e);var n=S[e];"object"==typeof n&&(n.trackedServers.forEach(function(e){"undefined"!=typeof e.subscriptionId&&(t.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:b}),delete _[e.subscriptionId])}),n.trackedServers=[],f(n,b),delete S[e])}t.on("subscribed",u),t.on("event",a),t.on("subscription-cancelled",d);var p="subscribe",m="awaitingAccept",h="subscribed",g="Subscription failed.",y="Subscription rejected.",v="ServerInitiated",b="ClientInitiated",S={},_={},w=0;return{subscribe:i}}},function(e,t,n){var r=n(1),o=n(33);e.exports=function(e,t,n,i){"use strict";function s(e){var t=e.new_peer_id,r=e.identity,o={machine:r.machine,pid:r.process,instance:r.instance,application:r.application,environment:r.environment,region:r.region,user:r.user};n.addServer(o,t)}function c(e){var t=e.removed_id,r=e.reason;n.removeServerById(t,r)}function u(e){var t=e.server_id;e.methods.forEach(function(e){var r={id:e.id,name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types,accepts:e.input_signature,returns:e.result_signature,supportsStreaming:"undefined"!=typeof e.flags&&e.flags.supportsStreaming};n.addServerMethod(t,r)})}function a(e){var t=e.server_id,r=e.methods,o=n.getServerById(t);Object.keys(o.methods).forEach(function(e){var i=o.methods[e];r.indexOf(i.info.id)>-1&&n.removeServerMethod(t,e)})}function d(e,n,r,o){var s=o.id,c=n.info.id;i.debug("sending call ("+e+") for method id "+c+" to server "+s);var u={type:"call",server_id:s,method_id:c,arguments_kv:r};t.send(u,{invocationId:e,serverId:s}).then(l)["catch"](p)}function f(e){m.add("onResult",e)}function l(e){i.debug("handle result message "+e);var t=e._tag.invocationId,r=e.result,o=e._tag.serverId,s=n.getServerById(o);m.execute("onResult",t,s.getInfoForUser(),0,r,"")}function p(e){i.debug("handle invocation error "+e);var t=e._tag.invocationId,r=e._tag.serverId,o=n.getServerById(r),s=e.reason,c=e.context;m.execute("onResult",t,o.getInfoForUser(),1,c,s)}t.on("peer-added",s),t.on("peer-removed",c),t.on("methods-added",u),t.on("methods-removed",a);var m=r();return{invoke:d,onInvocationResult:f,subscribe:new o(e,t,n,i).subscribe}}},function(e,t,n){var r=n(37),o=n(34);e.exports=function(e,t,n,i,s,c){"use strict";function u(){f.info("reconnected - will replay registered methods and subscriptions"),n.reset(),n.addServer(e,t.peerId);var r=i.getList();i.reset(),r.forEach(function(e){var t=e.definition,n=e.theFunction.userCallback,r=c().register;e.theFunction.isAsync&&(r=c().registerAsync),r(t,n)})}function a(){n.addServer(e,t.peerId),d({invoke:h.invoke,onInvocationResult:h.onInvocationResult,register:m.register,unregister:m.unregister,onInvoked:m.onInvoked,methodInvocationResult:m.methodInvocationResult,subscribe:h.subscribe,createStream:m.createStream,getBranchList:m.getBranchList,getSubscriptionList:m.getSubscriptionList,closeAllSubscriptions:m.closeAllSubscriptions,closeSingleSubscription:m.closeSingleSubscription,pushData:m.pushData,pushDataToSingle:m.pushDataToSingle,onSubRequest:m.onSubRequest,acceptRequestOnBranch:m.acceptRequestOnBranch,rejectRequest:m.rejectRequest,onSubAdded:m.onSubAdded,onSubRemoved:m.onSubRemoved}),d=undefined}var d,f=s.logger.subLogger("gw3-protocol"),l=new Promise(function(e){d=e}),p=t.domain("agm",f.subLogger("domain")),m=r(e,p,n,i,f.subLogger("server")),h=o(e,p,n,f.subLogger("client"));return p.onJoined(function(e){e?u():a()}),p.join(),l}},function(e,t,n){var r=n(1);e.exports=function(e,t,n,o,i){"use strict";function s(){var e=T;return T+=1,e}function c(e){i.debug("server_AddInterest ",e);var t=n.getServerById(e.caller_id),r="function"==typeof t.getInfoForUser?t.getInfoForUser():null,s={msg:e,arguments:e.arguments_kv||{},instance:r},c=o.getById(e.method_id);return c===undefined?void u("No method with id "+e.method_id+" on this server.",e.subscription_id):c.subscriptionsMap&&c.subscriptionsMap[e.subscription_id]?void u("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):void M.execute(S,s,c)}function u(e,n){var r={type:"error",reason_uri:j,reason:e,request_id:n};t.sendFireAndForget(r)}function a(e,n,r){if(console.log("requestContext",e),"string"!=typeof r&&(r="",console.log("empty branch",r)),"object"!=typeof n.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(n.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var o=d(n,r),i=e.msg.subscription_id,s={id:i,arguments:e.arguments,instance:e.instance,branchKey:r,streamId:o,subscribeMsg:e.msg};n.subscriptionsMap[i]=s,t.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:o}),M.execute(_,s,n)}function d(e,t){"string"!=typeof t&&(t="");var n=e.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],r=n?n.streamId:undefined;return"string"==typeof r&&""!==r||(r=s(),e.branchKeyToStreamIdMap.push({key:t,streamId:r})),r}function f(e,t,n){"string"!=typeof n&&(n=""),u("Subscription rejected by user. "+n,e.msg.subscription_id)}function l(e,t){M.add(e,t)}function p(e,n,r){if("object"==typeof e&&Array.isArray(e.branchKeyToStreamIdMap)){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof r?r=[r]:(!Array.isArray(r)||r.length<=0)&&(r=null);e.branchKeyToStreamIdMap.filter(function(e){return null===r||Boolean(e)&&"string"==typeof e.key&&r.indexOf(e.key)>=0}).map(function(e){return e.streamId}).forEach(function(e){t.sendFireAndForget({type:"publish",stream_id:e,data:n})})}}function m(e,n,r){if("object"!=typeof r)throw new Error("Invalid arguments. Data must be an object.");t.sendFireAndForget({type:"post",subscription_id:n.id,data:r})}function h(e,n){delete e.subscriptionsMap[n.id],t.sendFireAndForget({type:"drop-subscription",subscription_id:n.id,reason:"Server dropping a single subscription"});n.instance;M.execute(w,n,e)}function g(e,n){if("object"==typeof e&&"object"==typeof e.subscriptionsMap){var r=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]});"string"==typeof n&&(r=r.filter(function(e){return e.branchKey===n})),r.forEach(function(n){delete e.subscriptionsMap[n.id],t.sendFireAndForget({type:"drop-subscription",subscription_id:n.id,reason:"Server dropping all subscriptions on stream_id: "+n.streamId})})}}function y(e,t){if("object"!=typeof e)return[];var n=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]});return"string"!=typeof t?n:n.filter(function(e){return e.branchKey===t})}function v(e){if("object"!=typeof e)return[];var t=Object.keys(e.subscriptionsMap).map(function(t){return e.subscriptionsMap[t]}),n=t.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),r=[];return n.filter(function(e){return!(null===e||r.indexOf(e)>=0)&&(r.push(e),!0)})}function b(e){i.debug("handleRemoveInterest",e);var t=o.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&"object"==typeof t.subscriptionsMap[e.subscription_id]){var n=t.subscriptionsMap[e.subscription_id];delete t.subscriptionsMap[e.subscription_id],M.execute(w,n,t)}}t.on("add-interest",c),t.on("remove-interest",b);var S="onSubscriptionRequest",_="onSubscriptionAdded",w="onSubscriptionRemoved",j="com.tick42.agm.errors.subscription.failure",M=r(),T=0;return{pushData:p,pushDataToSingle:m,onSubRequest:l.bind(null,S),onSubAdded:l.bind(null,_),onSubRemoved:l.bind(null,w),acceptRequestOnBranch:a,rejectRequest:f,getSubscriptionList:y,getBranchList:v,closeSingleSubscription:h,closeMultipleSubscriptions:g}}},function(e,t,n){var r=n(1),o=n(36);e.exports=function(e,t,n,i,s){"use strict";function c(e){var t=e._tag.methodId,n=i.getById(t);n&&n.registrationCallbacks&&(s.debug("registered method "+n.definition.name+" with id "+t),n.registrationCallbacks.success())}function u(e){s.warn(e);var t=e._tag.methodId,n=i.getById(t);n&&n.registrationCallbacks&&(s.debug("failed to register method "+n.definition.name+" with id "+t),n.registrationCallbacks.fail())}function a(e){var t=e.invocation_id,r=e.caller_id,o=e.method_id,c=e.arguments_kv;s.debug('received invocation for method id "'+o+'" from peer '+r);var u=i.getList(),a=u.filter(function(e){return e._repoId===o})[0];if(a!==undefined){var d=n.getServerById(r),f={args:c,instance:d.getInfoForUser()};g.execute("onInvoked",a,t,f)}}function d(e,t,n,r){e.subscriptionsMap={},e.branchKeyToStreamIdMap=[],f(e,n,r,!0)}function f(e,n,r,o){var i=e.definition;e.registrationCallbacks={success:n,fail:r};var a={};o===!0&&(a={supportsStreaming:!0}),s.debug('registering method "'+i.name+'"');var d={type:"register",methods:[{id:e._repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:a,object_types:i.objectTypes,input_signature:i.accepts,result_signature:i.returns,restrictions:undefined}]};t.send(d,{methodId:e._repoId}).then(c)["catch"](u)}function l(e){g.add("onInvoked",e)}function p(e,n,r,o){var i;i=r?{type:"error",request_id:n,reason_uri:"agm.errors.client_error",reason:r,context:o}:{type:"yield",invocation_id:n,peer_id:t.peerId,result:o},t.sendFireAndForget(i)}function m(e){var n={type:"unregister",methods:[e._repoId]};t.send(n).then(h)}function h(e){var t=e.request_id;s.debug("unregistered by requestId "+t)}var g=r(),y=new o(e,t,n,i,s);return t.on("invoke",a),{register:f,onInvoked:l,methodInvocationResult:p,unregister:m,createStream:d,getBranchList:y.getBranchList,getSubscriptionList:y.getSubscriptionList,closeAllSubscriptions:y.closeMultipleSubscriptions,closeSingleSubscription:y.closeSingleSubscription,pushData:y.pushData,pushDataToSingle:y.pushDataToSingle,onSubRequest:y.onSubRequest,acceptRequestOnBranch:y.acceptRequestOnBranch,rejectRequest:y.rejectRequest,onSubAdded:y.onSubAdded,onSubRemoved:y.onSubRemoved}}},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=26)}([function(e,t,n){"use strict";function r(){function e(e,t){var r=n[e];return r||(r=[],n[e]=r),r.push(t),function(){var r=n[e];r=r.filter(function(e){return e!==t}),n[e]=r}}function t(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n[e];if(!o||0===o.length)return[];var i=[];return o.forEach(function(e){try{var n=e.apply(undefined,t);i.push(n)}catch(e){i.push(undefined)}}),i}var n={};return{add:e,execute:t}}r["default"]=r,e.exports=r},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(){l=!1}function o(e){if(!e)return void(d!==m&&(d=m,r()));if(e!==d){if(e.length!==m.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+m.length+" unique characters. These characters were not unique: "+t.join(", "));d=e,r()}}function i(e){return o(e),d}function s(e){p.seed(e),f!==e&&(r(),f=e)}function c(){d||o(m);for(var e,t=d.split(""),n=[],r=p.nextValue();t.length>0;)r=p.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function u(){return l?l:l=c()}function a(e){return u()[e]}var d,f,l,p=n(23),m="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={characters:i,seed:s,lookup:a,shuffled:u}},function(e,t){e.exports={name:"tick42-gateway-connection",version:"2.2.10",description:"Tick42 Gateway Connection.",precommit:"tslint",main:"dist/node/tick42-gateway-connection.js",browser:"dist/web/tick42-gateway-connection.js",types:"types/index.d.ts",scripts:{clean:"node ./build/scripts/clean.js","pre:build":"tsc && set NODE_ENV=development && npm run clean","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/main.ts","tslint:fix":"tslint -t codeFrame --fix ./src/main.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify && npm run types","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify && npm run types",docs:"typedoc --options typedoc.json ./src",types:"node ./build/scripts/copy-types.js","types:merged":"dts-generator --project ./ --out ./types/index.d.ts",prepublish:"npm run build:prod && npm run test:only",test:"npm run build:dev && mocha ./tests","test:only":"mocha ./tests"},devDependencies:{"@types/es6-promise":"0.0.32","@types/shortid":"0.0.28","@types/tick42-logger":"^3.0.0","babel-core":"^6.25.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-es6-promise":"^1.0.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0",chai:"^4.0.2","dts-generator":"^2.1.0","es6-promise":"^4.1.0",mocha:"^3.4.2",onchange:"3.*","pre-commit":"^1.1.3",shelljs:"^0.6.0","tick42-gateway":"^0.2.26","tick42-webpack-config":"4.1.6","ts-node":"^3.0.6",tslint:"^5.4.3",typedoc:"^0.5.10",typescript:"2.3.0",webpack:"2.3.3"},dependencies:{"callback-registry":"^2.2.7",shortid:"^2.2.6",ws:"^0.7.2"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=(n(3),function(){function e(e){this.messageHandlers={},this.ids=1,this.registry=r["default"](),this._connected=!1,this._settings=e}return e.prototype.init=function(e,t){this._protocol=t,this._transport=e,this._transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this._transport.onMessage(this.handleTransportMessage.bind(this))},e.prototype.send=function(e,t,n,r){if(this._transport.isObjectBasedTransport){var o=this._protocol.createObjectMessage(e,t,n,r);this._transport.sendObject(o,e,t)}else{var i=this._protocol.createStringMessage(e,t,n,r);this._transport.send(i,e,t)}},e.prototype.on=function(e,t,n){t=t.toLowerCase(),this.messageHandlers[t]===undefined&&(this.messageHandlers[t]={});var r=this.ids++;return this.messageHandlers[t][r]=n,{type:t,id:r}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.connected=function(e){return this._connected&&e(this._settings.ws||this._settings.http),this.registry.add("connected",e)},e.prototype.disconnected=function(e){this.registry.add("disconnected",e)},e.prototype.login=function(e){return this._protocol.login(e)},e.prototype.logout=function(){this._protocol.logout(),this._transport.close()},e.prototype.loggedIn=function(e){this._protocol.loggedIn(e)},Object.defineProperty(e.prototype,"protocolVersion",{get:function(){return this._settings.protocolVersion||1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._settings.version},enumerable:!0,configurable:!0}),e.prototype.toAPI=function(){var e=this;return{send:e.send.bind(e),on:e.on.bind(e),off:e.off.bind(e),login:e.login.bind(e),logout:e.logout.bind(e),loggedIn:e.loggedIn.bind(e),connected:e.connected.bind(e),disconnected:e.disconnected.bind(e),get protocolVersion(){return e.protocolVersion},get version(){return e.version}}},e.prototype.distributeMessage=function(e,t){var n=this.messageHandlers[t.toLowerCase()];n!==undefined&&Object.keys(n).forEach(function(t){var r=n[t];r!==undefined&&r(e)})},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?this.registry.execute("connected"):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"==typeof e?this._protocol.processStringMessage(e):this._protocol.processObjectMessage(e),this.distributeMessage(t.msg,t.msgType)},e}());t["default"]=o},function(e,t,n){"use strict";function r(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|o()),n=t<Math.pow(16,r+1),r++;return i}var o=n(22);e.exports=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.init=function(t,n){e.prototype.init.call(this,t,n),this.gw3Protocol=n},t.prototype.toAPI=function(){var t=this,n=e.prototype.toAPI.call(this);return{domain:t.domain.bind(t),get peerId(){return t.peerId},get token(){return t.token},get info(){return t.info},get resolvedIdentity(){return t.resolvedIdentity},get availableDomains(){return t.availableDomains},on:n.on,send:n.send,off:n.off,login:n.login,logout:n.logout,loggedIn:n.loggedIn,connected:n.connected,disconnected:n.disconnected,get protocolVersion(){return n.protocolVersion},get version(){return n.version}}},t.prototype.domain=function(e,t){return this.gw3Protocol.domain(e,t)},t}(o["default"]);t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.processStringMessage=function(e){var t=JSON.parse(e);return{msg:t.message,msgType:t.type}},e.prototype.createStringMessage=function(e,t,n,r){return JSON.stringify({type:t,message:n,id:r})},e.prototype.login=function(e){return Promise.resolve({})},e.prototype.logout=function(){},e.prototype.loggedIn=function(e){e()},e.prototype.processObjectMessage=function(e){throw new Error("not supported")},e.prototype.createObjectMessage=function(e,t,n,r){throw new Error("not supported")},e}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="LOGIN",o="LOGIN_RESPONSE",i="LOGIN_TOKEN",s="LOGOUT",c="SEND",u=function(){function e(e){this.connection=e}return e.prototype.processStringMessage=function(e){var t=JSON.parse(e);return t.type===c?{msg:t.data.message,msgType:t.data.type}:{msg:t,msgType:t.type}},e.prototype.createStringMessage=function(e,t,n,o){return t===r?JSON.stringify(n):t===s?JSON.stringify({type:"LOGOUT"}):JSON.stringify({type:c,sessionCookie:this.sessionCookie,data:{type:t,message:n,id:o}})},e.prototype.login=function(e){var t=this;return new Promise(function(n,s){var c;if(e.token)c={token:e.token,type:i};else{if(!e.username)throw new Error("Invalid auth message"+JSON.stringify(e));c={user:e.username,password:e.password,type:r}}var u=t.connection.on("",o,function(e){t.connection.off(u),e&&!e.errorMessage?(t.sessionCookie=e.sessionCookie,n(e)):s(e)});t.connection.send("","LOGIN",c)})},e.prototype.logout=function(){this.connection.send("","LOGOUT",{})},e.prototype.loggedIn=function(e){e()},e.prototype.processObjectMessage=function(e){throw new Error("not supported")},e.prototype.createObjectMessage=function(e,t,n,r){throw new Error("not supported")},e}();t["default"]=u},function(e,t,n){"use strict";function r(e,t,n){function r(e){var t=JSON.parse(e,function(e,t){if("string"!=typeof t)return t;if(t.length<S)return t;if(t[0]!==_)return t;try{var n=parseInt(t.substring(b,t.length),10);return isNaN(n)?t:new Date(n)}catch(e){return t}});return{msg:t,msgType:t.type}}function s(e,t,n,r){var o=Date.prototype.toJSON;Date.prototype.toJSON=function(){return v+this.getTime()};var i=JSON.stringify(n);return Date.prototype.toJSON=o,i}function c(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}function u(e,t,n,r){return n}function a(r){return n.debug("logging in..."),y=r,M=!0,new Promise(function(i,s){var c={},u=p();if(u)c.method="gateway-token",c.token=u;else if(r.token)c.method="access-token",c.token=r.token;else{if(!r.username)throw new Error("invalid auth message"+JSON.stringify(r));c.method="secret",c.login=r.username,c.secret=r.password}var a={type:"hello",identity:t.identity,authentication:c};o["default"]("global",e,n).send(a).then(function(t){n.debug("login successful with PeerId "+t.peer_id),e.peerId=t.peer_id,e.resolvedIdentity=t.resolved_identity,e.availableDomains=t.available_domains,t.options&&(e.token=t.options.access_token,e.info=t.options.info),h(!0),i(t.resolved_identity)})["catch"](function(e){n.error("error sending hello message - "+e),s(e)})})}function d(){n.debug("logging out..."),M=!1,T.forEach(function(e){e.leave()})}function f(e){return j&&e(),w.add("onLoggedIn",e)}function l(t,n){var r=o["default"](t,e,n);return T.push(r),r}function p(){if(t.gwTokenProvider)return t.gwTokenProvider.get();if("undefined"!=typeof location&&location.search){return new URLSearchParams(location.search.slice(1)).get("t42gwtoken")}return null}function m(){h(!1),n.debug("disconnected - will try new login?"+M),M&&e.login(y)["catch"](function(){setTimeout(m,1e3)})}function h(e){(j=e)&&w.execute("onLoggedIn")}function g(){j&&e.send("","",{type:"ping"}),setTimeout(g,3e4)}var y,v="#T42_DATE#",b=v.length,S=b+1,_=v[0],w=i["default"](),j=!1,M=!0,T=[];return e.disconnected(m.bind(this)),g(),{processStringMessage:r,createStringMessage:s,createObjectMessage:u,processObjectMessage:c,login:a,logout:d,loggedIn:f,domain:l}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(27),i=n(0);t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),o=function(){function e(){}return e.prototype.processStringMessage=function(e){var t=JSON.parse(e);return{msg:t,msgType:t.type}},e.prototype.createStringMessage=function(e,t,n,r){return JSON.stringify(n)},e.prototype.login=function(e){return r.Promise.resolve({})},e.prototype.logout=function(){},e.prototype.loggedIn=function(e){e()},e.prototype.processObjectMessage=function(e){throw new Error("not supported")},e.prototype.createObjectMessage=function(e,t,n,r){throw new Error("not supported")},e}();t["default"]=o},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(){this.connectionId=Math.floor(1e10*Math.random()).toString()}return t.prototype.send=function(t,n,r){"metrics"===n?e.htmlContainer.metricsFacade.send(r,t):"log"===n&&e.htmlContainer.loggingFacade.send(r,t)},t.prototype.onConnectedChanged=function(e){e(!0)},t.prototype.onMessage=function(e){},t.prototype.close=function(){},t}();t["default"]=n}).call(t,n(1))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function t(e,t){this.registry=r["default"](),this.url=e.http,this.interval=e.httpInterval||1e3,this.logger=t,this.logger.debug("Attempting connection to Gateway via HTTP with url "+this.url+" on interval "+this.interval+" ms")}return t.prototype.close=function(){},t.prototype.onConnectedChanged=function(e){e(!0)},t.prototype.onMessage=function(e){this.registry.add("onMessage",e)},t.prototype.send=function(e){this.httpPost(this.url,e)},t.prototype.poll=function(e,t,n,r){var o=this,i=e;0!==n&&(i=e+"?sequence="+n+"&no-cache="+(new Date).getTime());var s=this.createCORSRequest("GET",i,function(){0===n&&o.logger.debug("Connected to Gateway on "+e);var i=JSON.parse(s.responseText),c=i.nextSequence;r(i.data),setTimeout(function(){o.poll(e,t,c,r)},o.interval)});s.onerror=function(s){console.log("Error polling data from http server "+i+" -  + "+s),setTimeout(function(){o.poll(e,t,n,r)},o.interval)},s.send()},t.prototype.httpPost=function(e,t){this.createCORSRequest("POST",e).send(t)},t.prototype.createCORSRequest=function(t,n,r){var o=new XMLHttpRequest;return"withCredentials"in o?(o.open(t,n,!0),void 0!==r&&(o.onreadystatechange=function(){4===o.readyState&&200===o.status&&r()})):"undefined"!=typeof e.XDomainRequest?(o=new e.XDomainRequest,o.open(t,n),void 0!==r&&(o.onload=r)):o=null,o},t}();t["default"]=o}).call(t,n(1))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){function e(e,t,n){this.registry=r["default"](),this.gw=t,this.gwToken=e,this.logger=n,this.connectToken=this.gw.connect(this.gwToken,this.messageHandler.bind(this))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.sendObject=function(e){this.gw.send(this.connectToken,e)},e.prototype.send=function(e,t,n){throw new Error("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){e(!0)},e.prototype.close=function(){},e.prototype.messageHandler=function(e){"trace"===this.logger.consoleLevel()&&this.logger.debug(JSON.stringify(e)),this.registry.execute("onMessage",e)},e}();t["default"]=o},function(e,t,n){"use strict";(function(e){function r(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=r()?n(25):e.WebSocket,s=function(){function e(e,t){this._shouldTryConnecting=!0,this._registry=o["default"](),this._settings=e,this._logger=t,this.waitForSocketConnection(undefined)}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e){var t=this;this.waitForSocketConnection(function(){t._ws.send(e)})},e.prototype.close=function(){this._shouldTryConnecting=!1,this._ws.close()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.initiateSocket=function(){var e=this;this._logger.debug("initiating _ws..."),this._ws=new i(this._settings.ws),this._ws.onclose=function(){e._logger.debug("_ws closed"),e._registry.execute("onConnectedChanged",!1)},this._ws.onopen=function(){e._logger.debug("_ws opened"),e._registry.execute("onConnectedChanged",!0)},this._ws.onmessage=function(t){e._registry.execute("onMessage",t.data)}},e.prototype.waitForSocketConnection=function(e){var t=this;if(e||(e=function(){}),this._shouldTryConnecting){if(!this._ws||this._ws.readyState>1)this.initiateSocket();else if(1===this._ws.readyState)return e();setTimeout(function(){t.waitForSocketConnection(e)},this._settings.reconnectInterval)}},e}();t["default"]=s}).call(t,n(1))},function(e,t,n){(function(t,r){!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){Y=e}function s(e){z=e}function c(){return function(){return t.nextTick(l)}}function u(){return void 0!==W?function(){W(l)}:f()}function a(){var e=0,t=new $(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<X;e+=2){(0,ne[e])(ne[e+1]),ne[e]=undefined,ne[e+1]=undefined}X=0}function p(){try{var e=n(28);return W=e.runOnLoop||e.runOnContext,u()}catch(e){return f()}}function m(e,t){var n=arguments,r=this,o=new this.constructor(g);o[oe]===undefined&&P(o);var i=r._state;return i?function(){var e=n[i-1];z(function(){return k(i,o,e,r._result)})}():E(r,o,e,t),o}function h(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(g);return M(n,e),n}function g(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function b(e){try{return e.then}catch(e){return ue.error=e,ue}}function S(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function _(e,t,n){z(function(e){var r=!1,o=S(n,t,function(n){r||(r=!0,t!==n?M(e,n):I(e,n))},function(t){r||(r=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,A(e,o))},e)}function w(e,t){t._state===se?I(e,t._result):t._state===ce?A(e,t._result):E(t,undefined,function(t){return M(e,t)},function(t){return A(e,t)})}function j(e,t,n){t.constructor===e.constructor&&n===m&&t.constructor.resolve===h?w(e,t):n===ue?(A(e,ue.error),ue.error=null):n===undefined?I(e,t):o(n)?_(e,t,n):I(e,t)}function M(t,n){t===n?A(t,y()):e(n)?j(t,n,b(n)):I(t,n)}function T(e){e._onerror&&e._onerror(e._result),O(e)}function I(e,t){e._state===ie&&(e._result=t,e._state=se,0!==e._subscribers.length&&z(O,e))}function A(e,t){e._state===ie&&(e._state=ce,e._result=t,z(T,e))}function E(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+se]=n,o[i+ce]=r,0===i&&e._state&&z(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=undefined,o=undefined,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?k(n,r,o,i):o(i);e._subscribers.length=0}}function N(){this.error=null}function C(e,t){try{return e(t)}catch(e){return ae.error=e,ae}}function k(e,t,n,r){var i=o(n),s=undefined,c=undefined,u=undefined,a=undefined;if(i){if(s=C(n,r),s===ae?(a=!0,c=s.error,s.error=null):u=!0,t===s)return void A(t,v())}else s=r,u=!0;t._state!==ie||(i&&u?M(t,s):a?A(t,c):e===se?I(t,s):e===ce&&A(t,s))}function R(e,t){try{t(function(t){M(e,t)},function(t){A(e,t)})}catch(t){A(e,t)}}function x(){return de++}function P(e){e[oe]=de++,e._state=undefined,e._result=undefined,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(g),this.promise[oe]||P(this.promise),H(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&I(this.promise,this._result))):A(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function q(e){return new D(this,e).promise}function L(e){var t=this;return new t(H(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function U(e){var t=this,n=new t(g);return A(n,e),n}function B(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function V(e){this[oe]=x(),this._result=this._state=undefined,this._subscribers=[],g!==e&&("function"!=typeof e&&B(),this instanceof V?R(this,e):J())}function G(){var e=undefined;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=V}var K=undefined;K=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=K,X=0,W=undefined,Y=undefined,z=function(e,t){ne[X]=e,ne[X+1]=t,2===(X+=2)&&(Y?Y(l):re())},Q="undefined"!=typeof window?window:undefined,Z=Q||{},$=Z.MutationObserver||Z.WebKitMutationObserver,ee="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=undefined;re=ee?c():$?a():te?d():Q===undefined?p():f();var oe=Math.random().toString(36).substring(16),ie=void 0,se=1,ce=2,ue=new N,ae=new N,de=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ie&&n<e;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===h){var o=b(e);if(o===m&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===V){var i=new n(g);j(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ie&&(this._remaining--,e===ce?A(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;E(e,undefined,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ce,t,e)})},V.all=q,V.race=L,V.resolve=h,V.reject=U,V._setScheduler=i,V._setAsap=s,V._asap=z,V.prototype={constructor:V,then:m,catch:function(e){return this.then(null,e)}},V.polyfill=G,V.Promise=V,V})}).call(t,n(16),n(1))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){h&&p&&(h=!1,p.length?m=p.concat(m):g=-1,m.length&&c())}function c(){if(!h){var e=o(s);h=!0;for(var t=m.length;t;){for(p=m,m=[];++g<t;)p&&p[g].run();g=-1,t=m.length}p=null,h=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function a(){}var d,f,l=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var p,m=[],h=!1,g=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||h||o(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,n){"use strict";e.exports=n(20)},function(e,t,n){"use strict";function r(e){var t="",n=Math.floor(.001*(Date.now()-u));return n===i?o++:(o=0,i=n),t+=s(c.lookup,a),t+=s(c.lookup,e),o>0&&(t+=s(c.lookup,o)),t+=s(c.lookup,n)}var o,i,s=n(5),c=n(2),u=1459707606518,a=6;e.exports=r},function(e,t,n){"use strict";function r(e){var t=o.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var o=n(2);e.exports=r},function(e,t,n){"use strict";function r(t){return c.seed(t),e.exports}function o(t){return f=t,e.exports}function i(e){return e!==undefined&&c.characters(e),c.shuffled()}function s(){return a(f)}var c=n(2),u=(n(5),n(19)),a=n(18),d=n(21),f=n(24)||0;e.exports=s,e.exports.generate=s,e.exports.seed=r,e.exports.worker=o,e.exports.characters=i,e.exports.decode=u,e.exports.isValid=d},function(e,t,n){"use strict";function r(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=o.characters(),n=e.length,r=0;r<n;r++)if(t.indexOf(e[r])===-1)return!1;return!0}var o=n(2);e.exports=r},function(e,t,n){"use strict";function r(){if(!o||!o.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return o.getRandomValues(e),48&e[0]}var o="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=r},function(e,t,n){"use strict";function r(){return(i=(9301*i+49297)%233280)/233280}function o(e){i=e}var i=1;e.exports={nextValue:r,seed:o}},function(e,t,n){"use strict";e.exports=0},function(e,t){function n(e,t,n){return t?new o(e,t):new o(e)}var r=function(){return this}(),o=r.WebSocket||r.MozWebSocket;e.exports=o?n:null,o&&(n.prototype=o.prototype)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(9),i=n(10),s=n(14),c=n(6),u=n(7),a=n(11),d=n(8),f=n(13),l=n(12),p=n(3);t["default"]=function(t){t=t||{},t.version=p.version;var n=new r["default"](t),m=t.logger;if(!m)throw new Error("please pass a logger object");var h=new i["default"],g=new a["default"];if(e.htmlContainer===undefined){if(t.gw&&t.gw.facade&&t.gw.token&&3===t.protocolVersion)g=new f["default"](t.gw.token,t.gw.facade,m.subLogger("inproc"));else if(t.ws!==undefined)g=new s["default"](t,m.subLogger("ws"));else{if(t.http===undefined)throw new Error("No connection information specified");g=new l["default"](t,m.subLogger("http"))}if(3===t.protocolVersion){var y=new c["default"](t),v=o["default"](y,t,m.subLogger("gw3"));return y.init(g,v),y.toAPI()}h=2===t.protocolVersion?new d["default"](n):new u["default"]}return n.init(g,h),n.toAPI()}}).call(t,n(1))},function(e,t,n){"use strict";function r(e,t,n){function r(t){return y=t,new Promise(function(r,o){n.debug("joining "+e),h({type:"join",destination:e,domain:"global",options:t}).then(function(){c(),r()})["catch"](function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),o(t)})})}function s(){n.debug("stopping session "+e+"..."),h({type:"leave",destination:e,domain:"global"}).then(function(){v=!1,S.execute("onLeft")})}function c(){n.debug("joined "+e),v=!0;var t=b;b=!1,S.execute("onJoined",t)}function u(){n.warn("connection is down"),v=!1,b=!0,S.execute("onLeft",{disconnected:!0})}function a(){b&&(n.info("connection is now up - trying to reconnect..."),r(y))}function d(e){return v&&e(!1),S.add("onJoined",e)}function f(e){return v||e(),S.add("onLeft",e)}function l(t){if(e===t.domain){var n=t.request_id,r=_[n];r&&r.error(t)}}function p(t){if(t.domain===e){var n=t.request_id,r=_[n];r&&r.success(t)}}function m(){return i.generate()}function h(r,o){r.request_id=r.request_id||m(),r.domain=r.domain||e,r.peer_id=t.peerId;var i=r.request_id;return new Promise(function(s,c){_[i]={success:function(e){delete _[i],e._tag=o,s(e)},error:function(e){n.warn("GW error - "+JSON.stringify(e)+" for request "+JSON.stringify(r)),delete _[i],e._tag=o,c(e)}},t.send(e,e,r)})}function g(n){n.request_id=n.request_id?n.request_id:m(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(e,e,n)}var y,v=!1,b=!1,S=o();t.disconnected(u),t.loggedIn(a),t.on(e,"welcome",function(e){return p(e)}),t.on(e,"error",function(e){return l(e)}),t.on(e,"success",function(e){return p(e)}),t.on(e,"result",function(e){return p(e)}),t.on(e,"subscribed",function(e){return p(e)});var _={};return{join:r,leave:s,onJoined:d,onLeft:f,send:h,sendFireAndForget:g,on:function(n,r){t.on(e,n,r)},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId}}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(17);t["default"]=r},function(e,t){}])})},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=function(){function e(e,t,n){this._subloggers=[],this._name=e,this._parent=t,this._path=t?t.path+"."+e:e,this._loggerFullName="["+this._path+"]",void 0!==n&&this.metricsLevel("warn",n.subSystem(e))}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),e.prototype.subLogger=function(t){var n=this._subloggers.filter(function(e){return e.name===t})[0];if(n!==undefined)return n;Object.keys(this).forEach(function(e){if(e===t)throw new Error("This sub logger name is not allowed.")});var r=new e(t,this);return this._subloggers.push(r),r},e.prototype.publishLevel=function(e){return null!==e&&e!==undefined&&(this._publishLevel=e),this._publishLevel||this._parent.publishLevel()},e.prototype.consoleLevel=function(e){return null!==e&&e!==undefined&&(this._consoleLevel=e),this._consoleLevel||this._parent.consoleLevel()},e.prototype.metricsLevel=function(e,t){if(null!==e&&e!==undefined&&(this._metricLevel=e),t!==undefined){if("object"!==(void 0===t?"undefined":r(t))||"function"!=typeof t.objectMetric)throw new Error("Please specify metric system");this._metricSystem=t}return this._metricLevel||this._parent.metricsLevel()},e.prototype.log=function(e,t){this.publishMessage(t||o["default"].info,e)},e.prototype.trace=function(e){this.log(e,o["default"].trace)},e.prototype.debug=function(e){this.log(e,o["default"].debug)},e.prototype.info=function(e){this.log(e,o["default"].info)},e.prototype.warn=function(e){this.log(e,o["default"].warn)},e.prototype.error=function(e){this.log(e,o["default"].error)},e.prototype.toAPIObject=function(){var e=this;return{name:this.name,subLogger:this.subLogger.bind(e),publishLevel:this.publishLevel.bind(e),consoleLevel:this.consoleLevel.bind(e),metricsLevel:this.metricsLevel.bind(e),log:this.log.bind(e),trace:this.trace.bind(e),debug:this.debug.bind(e),info:this.info.bind(e),warn:this.warn.bind(e),error:this.error.bind(e)}},e.prototype.publishMessage=function(t,n){var r=this._loggerFullName;if(t===o["default"].error){var i=new Error;i.stack&&(n=n+"\n"+i.stack.split("\n").slice(3).join("\n"))}if(o["default"].canPublish(t,this.consoleLevel())){var s=r+": "+n;switch(t){case o["default"].trace:console.trace(s);break;case o["default"].debug:console.debug?console.debug(s):console.log(s);break;case o["default"].info:console.info(s);break;case o["default"].warn:console.warn(s);break;case o["default"].error:console.error(s)}}o["default"].canPublish(t,this.publishLevel())&&e.GetConnection().send("log","LogMessage",{instance:e.Instance,level:o["default"].order.indexOf(t),logger:r,message:n}),o["default"].canPublish(t,this.metricsLevel())&&this._metricSystem!==undefined&&(this._metricSystem.objectMetric("LogMessage",{Level:t,Logger:r,Message:n,Time:new Date}),t===o["default"].error&&this._metricSystem.setState(100,n))},e}();t["default"]=i},function(e,t){e.exports={name:"tick42-logger",version:"3.0.8",description:"Glue library for logging",main:"dist/node/tick42-logger.js",browser:"dist/web/tick42-logger.js",types:"./types/index.d.ts",scripts:{clean:"node ./build/scripts/clean.js","pre:build":"npm run tslint && tsc && set NODE_ENV=development && npm run clean","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/main.ts","tslint:fix":"tslint -t codeFrame --fix ./src/main.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify && npm run types","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify && npm run types",docs:"typedoc --options typedoc.json ./src",types:"node ./build/scripts/copy-types.js",prepublish:"npm run build:prod","types:merged":"dts-generator --project ./ --out ./types/index.d.ts"},repository:{type:"git",url:"https://stash.tick42.com:8443/scm/ofgw/js-logger.git"},author:"Tick42",license:"ISC",precommit:"tslint:fix",devDependencies:{"@types/tick42-gateway-connection":"^2.2.3","babel-core":"^6.17.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-es6-promise":"^1.0.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0","dts-generator":"^2.1.0","es6-promise":"^4.1.0",onchange:"3.*","pre-commit":"^1.1.3",shelljs:"^0.6.0","tick42-webpack-config":"4.1.1",tslint:"5.*",typedoc:"^0.5.10",typescript:"2.3.0",webpack:"2.3.3"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.canPublish=function(t,n){return e.order.indexOf(t)>=e.order.indexOf(n)},e}();r.off="off",r.trace="trace",r.debug="debug",r.info="info",r.warn="warn",r.error="error",r.order=[r.trace,r.debug,r.info,r.warn,r.error,r.off],t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(1);t["default"]=function(e){var t=e.identity;if(!t)throw new Error("identity is missing");var n=t.system+"\\"+t.service+"\\"+t.instance;r["default"].Instance=n,r["default"].GetConnection=e.getConnection;var i=new r["default"]("main");i.publishLevel(e.publish||"off"),i.consoleLevel(e.console||"info"),i.metricsLevel(e.metrics||"off");var s=i.toAPIObject();return s.version=o.version,s}}])})},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=20)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={DEFAULT:0,STRING:1,NUMBER:2,COUNT:3,RATE:4,STATISTICS:6,TIMESTAMP:7,ADDRESS:8,TIMESPAN:10,OBJECT:11}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={validate:function(e,t,n){if(null===e||"object"!==(void 0===e?"undefined":r(e)))throw new Error("Missing definition");if(null===t||"object"!==(void 0===t?"undefined":r(t)))throw new Error("Missing parent");if(null===n||"object"!==(void 0===n?"undefined":r(n)))throw new Error("Missing transport")}}},function(e,t){e.exports={name:"tick42-metrics",version:"2.3.4",description:"",main:"dist/node/tick42-metrics.js",browser:"dist/web/tick42-metrics.js",types:"types/index.d.ts",scripts:{clean:"node ./build/scripts/clean.js","pre:build":"npm run tslint && tsc && set NODE_ENV=development && npm run clean","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/main.ts","tslint:fix":"tslint -t codeFrame --fix ./src/main.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify && npm run types","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify && npm run types",docs:"typedoc --options typedoc.json ./src",types:"node ./build/scripts/copy-types.js",prepublish:"npm run build:prod","types:merged":"dts-generator --project ./ --out ./types/index.d.ts"},author:"Tick42",license:"ISC",precommit:"tslint:fix",devDependencies:{"@types/tick42-gateway-connection":"^2.2.4","@types/tick42-logger":"^3.0.6","babel-core":"^6.17.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-es6-promise":"^1.0.0","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0","dts-generator":"^2.1.0","es6-promise":"^4.1.0",onchange:"3.*","pre-commit":"^1.1.3",shelljs:"^0.6.0","tick42-webpack-config":"4.1.1",tslint:"5.*",typedoc:"^0.5.10",typescript:"2.3.0",webpack:"2.3.3"}}},function(e,t,n){"use strict";function r(e,t){function n(e){e.root&&0!==e.root.subSystems.length&&r(e.root)}function r(e){c(e),e.subSystems.forEach(function(e){r(e)}),e.metrics.forEach(function(e){a(e)})}function s(e){h("HeartbeatMetrics",{publishingInterval:m,instance:e.instance})}function c(e){e.parent!==undefined&&h("CreateMetricSystem",{id:e.id,instance:e.repo.instance,definition:{name:e.name,description:e.description,path:e.path}})}function u(e,t){h("UpdateMetricSystem",{id:e.id,instance:e.repo.instance,state:t})}function a(e){h("CreateMetric",i["default"](e))}function d(e){h("UpdateMetric",i["default"](e))}function f(e){s(e),p.on("metrics","MetricsSnapshotRequest",function(t){t.Instance===e.instance&&n(e)}),setInterval(function(){s(e)},m)}var l=3e3;if(!e||"object"!==(void 0===e?"undefined":o(e)))throw new Error("Connection is required parameter");var p=e,m=t.heartbeatInterval||l,h=function(e,t){p.send("metrics",e,t)};return{createSystem:c,updateSystem:u,createMetric:a,updateMetric:d,init:f}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18);t["default"]=r},function(e,t,n){"use strict";function r(e,t){if(!e||"object"!==(void 0===e?"undefined":o(e)))throw new Error("Connection is required parameter");var n,r,c=function(o){var s;n=new i.Promise(function(e){s=e}),r=e.domain("metrics",t.logger),r.onJoined(function(e){e||(s(),s=undefined);var t={name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};r.send(n),e&&u(o)}),r.join(t.identity)},u=function(e){a(e.root)},a=function e(t){d(t),t.metrics.forEach(function(e){l(e)}),t.subSystems.forEach(function(t){e(t)})},d=function(e){e.parent!==undefined&&n.then(function(){var t={name:s.normalizeMetricName(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};r.send(n)})},f=function(t,o){n.then(function(){var n={type:"publish",values:[{name:s.normalizeMetricName(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]};r.send(n);var i=s.composeMsgForRootStateMetric(t),c={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:i.description,Value:i.value},timestamp:Date.now()}]};r.send(c)})},l=function(e){n.then(function(){var t=s.serializeMetric(e),n={type:"define",metrics:[t]};r.send(n),"undefined"!=typeof e.value&&p(e)})},p=function(e){n.then(function(){var t=s.getMetricValueByType(e),n={type:"publish",values:[{name:s.normalizeMetricName(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};r.send(n)})};return{init:c,createSystem:d,updateSystem:f,createMetric:l,updateMetric:p}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),s=n(19);t["default"]=r},function(e,t,n){"use strict";function r(e,t){function n(e,t){if("undefined"!=typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!=typeof document){var n=e.subSystem("ClickStream"),r=function(e){if(e.target){var t=e.target;n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:e.target?t.className:"",id:t.id,type:"<"+t.tagName.toLowerCase()+">",href:t.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}}if(!e.identity)throw new Error("Identity missing from metrics configuration");if(!e.identity.service||"string"!=typeof e.identity.service)throw new Error("Service missing or invalid in metrics identity configuration");if(!e.identity.system||"string"!=typeof e.identity.system)throw new Error("System missing or invalid in metrics identity configuration");if(!e.identity.instance||"string"!=typeof e.identity.instance)throw new Error("Instance missing or invalid in metrics identity configuration");var r=e.identity,s=e.identity.system+"/"+e.identity.service+"/"+e.identity.instance,c=i.version,u={identity:r,instance:s,version:c,get root(){return a}};t.init(u);var a=o["default"]("",u,t);return n(a,e.clickStream||e.clickStream===undefined),u}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),i=n(2);t["default"]=r},function(e,t,n){"use strict";(function(r,o){var i,s,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(r,o){"object"===c(t)&&void 0!==e?e.exports=o():(i=o,(s="function"==typeof i?i.call(t,n,t,e):i)!==undefined&&(e.exports=s))}(undefined,function(){function e(e){return"function"==typeof e||"object"===(void 0===e?"undefined":c(e))&&null!==e}function t(e){return"function"==typeof e}function i(e){z=e}function s(e){Q=e}function u(){return function(){return r.nextTick(p)}}function a(){return void 0!==Y?function(){Y(p)}:l()}function d(){var e=0,t=new ee(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function f(){var e=new MessageChannel;return e.port1.onmessage=p,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(p,1)}}function p(){for(var e=0;e<W;e+=2){(0,re[e])(re[e+1]),re[e]=undefined,re[e+1]=undefined}W=0}function m(){try{var e=n(22);return Y=e.runOnLoop||e.runOnContext,a()}catch(e){return l()}}function h(e,t){var n=arguments,r=this,o=new this.constructor(y);o[ie]===undefined&&D(o);var i=r._state;return i?function(){var e=n[i-1];Q(function(){return R(i,o,e,r._result)})}():O(r,o,e,t),o}function g(e){var t=this;if(e&&"object"===(void 0===e?"undefined":c(e))&&e.constructor===t)return e;var n=new t(y);return T(n,e),n}function y(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function b(){return new TypeError("A promises callback cannot return that same promise.")}function S(e){try{return e.then}catch(e){return ae.error=e,ae}}function _(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function w(e,t,n){Q(function(e){var r=!1,o=_(n,t,function(n){r||(r=!0,t!==n?T(e,n):A(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,E(e,o))},e)}function j(e,t){t._state===ce?A(e,t._result):t._state===ue?E(e,t._result):O(t,undefined,function(t){return T(e,t)},function(t){return E(e,t)})}function M(e,n,r){n.constructor===e.constructor&&r===h&&n.constructor.resolve===g?j(e,n):r===ae?(E(e,ae.error),ae.error=null):r===undefined?A(e,n):t(r)?w(e,n,r):A(e,n)}function T(t,n){t===n?E(t,v()):e(n)?M(t,n,S(n)):A(t,n)}function I(e){e._onerror&&e._onerror(e._result),N(e)}function A(e,t){e._state===se&&(e._result=t,e._state=ce,0!==e._subscribers.length&&Q(N,e))}function E(e,t){e._state===se&&(e._state=ue,e._result=t,Q(I,e))}function O(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+ce]=n,o[i+ue]=r,0===i&&e._state&&Q(N,e)}function N(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=undefined,o=undefined,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?R(n,r,o,i):o(i);e._subscribers.length=0}}function C(){this.error=null}function k(e,t){try{return e(t)}catch(e){return de.error=e,de}}function R(e,n,r,o){var i=t(r),s=undefined,c=undefined,u=undefined,a=undefined;if(i){if(s=k(r,o),s===de?(a=!0,c=s.error,s.error=null):u=!0,n===s)return void E(n,b())}else s=o,u=!0;n._state!==se||(i&&u?T(n,s):a?E(n,c):e===ce?A(n,s):e===ue&&E(n,s))}function x(e,t){try{t(function(t){T(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function P(){return fe++}function D(e){e[ie]=fe++,e._state=undefined,e._result=undefined,e._subscribers=[]}function F(e,t){this._instanceConstructor=e,this.promise=new e(y),this.promise[ie]||D(this.promise),X(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&A(this.promise,this._result))):E(this.promise,q())}function q(){return new Error("Array Methods must be provided an Array")}function L(e){return new F(this,e).promise}function U(e){var t=this;return new t(X(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(y);return E(n,e),n}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function V(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[ie]=P(),this._result=this._state=undefined,this._subscribers=[],y!==e&&("function"!=typeof e&&J(),this instanceof G?x(this,e):V())}function K(){var e=undefined;if(void 0!==o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=G}var H=undefined;H=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var X=H,W=0,Y=undefined,z=undefined,Q=function(e,t){re[W]=e,re[W+1]=t,2===(W+=2)&&(z?z(p):oe())},Z="undefined"!=typeof window?window:undefined,$=Z||{},ee=$.MutationObserver||$.WebKitMutationObserver,te="undefined"==typeof self&&void 0!==r&&"[object process]"==={}.toString.call(r),ne="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3),oe=undefined;oe=te?u():ee?d():ne?f():Z===undefined?m():l();var ie=Math.random().toString(36).substring(16),se=void 0,ce=1,ue=2,ae=new C,de=new C,fe=0;return F.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===se&&n<e;n++)this._eachEntry(t[n],n)},F.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===g){var o=S(e);if(o===h&&e._state!==se)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===G){var i=new n(y);M(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},F.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===se&&(this._remaining--,e===ue?E(r,n):this._result[t]=n),0===this._remaining&&A(r,this._result)},F.prototype._willSettleAt=function(e,t){var n=this;O(e,undefined,function(e){return n._settledAt(ce,t,e)},function(e){return n._settledAt(ue,t,e)})},G.all=L,G.race=U,G.resolve=g,G.reject=B,G._setScheduler=i,G._setAsap=s,G._asap=Q,G.prototype={constructor:G,then:h,catch:function(e){return this.then(null,e)}},G.polyfill=K,G.Promise=G,G})}).call(t,n(7),n(8))},function(e,t,n){"use strict";function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(l===clearTimeout)return clearTimeout(e);if((l===o||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function c(){g&&m&&(g=!1,m.length?h=m.concat(h):y=-1,h.length&&u())}function u(){if(!g){var e=i(c);g=!0;for(var t=h.length;t;){for(m=h,h=[];++y<t;)m&&m[y].run();y=-1,t=h.length}m=null,g=!1,s(e)}}function a(e,t){this.fun=e,this.array=t}function d(){}var f,l,p=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{l="function"==typeof clearTimeout?clearTimeout:o}catch(e){l=o}}();var m,h=[],g=!1,y=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||g||i(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=d,p.addListener=d,p.once=d,p.off=d,p.removeListener=d,p.removeAllListeners=d,p.emit=d,p.prependListener=d,p.prependOnceListener=d,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){"use strict";var r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":o(window))&&(r=window)}e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){a=e,u.updateMetric(b)}function c(){return undefined}o["default"].validate(e,t,n);var u=n,a=r||"",d=t.path.slice(0);d.push(t.name);var f=e.name,l=e.description,p=e.period,m=e.resolution,h=t,g=t.repo,y=t.path+"/"+f,v=i["default"].ADDRESS,b={name:f,description:l,period:p,resolution:m,system:h,repo:g,id:y,type:v,get value(){return a},get path(){return d},update:s,getValueType:c};return u.createMetric(b),b}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){p=e,l.updateMetric(j)}function c(){return undefined}function u(e){s(p+e)}function a(){u(1)}function d(){u(-1)}function f(e){u(e*-1)}o["default"].validate(e,t,n);var l=n,p=r||0,m=t.path.slice(0);m.push(t.name);var h=e.name,g=e.description,y=e.period,v=e.resolution,b=t,S=t.repo,_=t.path+"/"+h,w=i["default"].COUNT,j={name:h,description:g,period:y,resolution:v,system:b,repo:S,id:_,type:w,get path(){return m},get value(){return p},update:s,getValueType:c,incrementBy:u,increment:a,decrement:d,decrementBy:f};return l.createMetric(j),j}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){m=e,l.updateMetric(j)}function c(){return undefined}function u(e){s(m+e)}function a(){u(1)}function d(){u(-1)}function f(e){u(e*-1)}o["default"].validate(e,t,n);var l=n,p=t.path.slice(0),m=r||0,h=e.name,g=e.description,y=e.period,v=e.resolution,b=t,S=t.repo,_=t.path+"/"+h,w=i["default"].NUMBER;p.push(t.name);var j={name:h,description:g,period:y,resolution:v,system:b,repo:S,id:_,get value(){return m},type:w,get path(){return p},update:s,getValueType:c,incrementBy:u,increment:a,decrement:d,decrementBy:f};return l.createMetric(j),j}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){u(e),a.updateMetric(S)}function c(){return undefined}function u(e){return Object.keys(d).forEach(function(t){"undefined"!=typeof e[t]&&(d[t]=e[t])})}i["default"].validate(e,t,n);var a=n,d=r||"",f=t.path.slice(0);f.push(t.name);var l=e.name,p=e.description,m=e.period,h=e.resolution,g=t,y=t.repo,v=t.path+"/"+l,b=o["default"].OBJECT,S={name:l,description:p,period:m,resolution:h,system:g,repo:y,id:v,type:b,get value(){return d},get path(){return f},update:s,getValueType:c};return a.createMetric(S),S}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(1);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){a=e,u.updateMetric(b)}function c(){return undefined}o["default"].validate(e,t,n);var u=n,a=r||"",d=t.path.slice(0);d.push(t.name);var f=e.name,l=e.description,p=e.period,m=e.resolution,h=t,g=t.repo,y=t.path+"/"+f,v=i["default"].RATE,b={name:f,description:l,period:p,resolution:m,system:h,repo:g,id:y,type:v,get value(){return a},get path(){return d},update:s,getValueType:c};return u.createMetric(b),b}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){a=e,u.updateMetric(b)}function c(){return undefined}o["default"].validate(e,t,n);var u=n,a=r||"",d=t.path.slice(0);d.push(t.name);var f=e.name,l=e.description,p=e.period,m=e.resolution,h=t,g=t.repo,y=t.path+"/"+f,v=i["default"].STATISTICS,b={name:f,description:l,period:p,resolution:m,system:h,repo:g,id:y,type:v,get value(){return a},get path(){return d},update:s,getValueType:c};return u.createMetric(b),b}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){a=e,u.updateMetric(b)}function c(){return undefined}o["default"].validate(e,t,n);var u=n,a=r||"",d=t.path.slice(0);d.push(t.name);var f=e.name,l=e.description,p=e.period,m=e.resolution,h=t,g=t.repo,y=t.path+"/"+f,v=i["default"].STRING,b={name:f,description:l,period:p,resolution:m,system:h,repo:g,id:y,get value(){return a},get path(){return d},type:v,update:s,getValueType:c};return u.createMetric(b),b}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){f=e,d.updateMetric(_)}function c(){s(!0)}function u(){s(!1)}function a(){return undefined}o["default"].validate(e,t,n);var d=n,f=r||"",l=t.path.slice(0);l.push(t.name);var p=e.name,m=e.description,h=e.period,g=e.resolution,y=t,v=t.repo,b=t.path+"/"+p,S=i["default"].TIMESPAN,_={name:p,description:m,period:h,resolution:g,system:y,repo:v,id:b,type:S,get value(){return f},get path(){return l},update:s,start:c,stop:u,getValueType:a};return d.createMetric(_),_}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e,t,n,r){function s(e){d=e,a.updateMetric(S)}function c(){s(new Date)}function u(){return undefined}o["default"].validate(e,t,n);var a=n,d=r||"",f=t.path.slice(0);f.push(t.name);var l=e.name,p=e.description,m=e.period,h=e.resolution,g=t,y=t.repo,v=t.path+"/"+l,b=i["default"].TIMESTAMP,S={name:l,description:p,period:m,resolution:h,system:g,repo:y,id:v,type:b,get value(){return d},get path(){return f},update:s,now:c,getValueType:u};return a.createMetric(S),S}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e){function t(e,n,o,s,c,u,a){var d={name:e,description:c,type:s?s:r(n),path:o,resolution:a,period:u};return d.type===i["default"].OBJECT&&(d.Composite=Object.keys(n).reduce(function(e,r){var i=n[r];return e.push(t(r,i,o)),e},[])),d}function n(e,t){if(e&&e.constructor===Date)return{value:{type:c.indexOf("date"),value:e.valueOf(),isArray:!1}};if("object"===(void 0===e?"undefined":o(e)))return{CompositeValue:Object.keys(e).reduce(function(t,r){var o=n(e[r]);return o.InnerMetricName=r,t.push(o),t},[])};var r=t?t.getValueType():undefined;return r=r||c.indexOf(void 0===e?"undefined":o(e)),{value:{type:r,value:e,isArray:!1}}}function r(e){switch(e.constructor===Date?"timestamp":void 0===e?"undefined":o(e)){case"string":return i["default"].STRING;case"number":return i["default"].NUMBER;case"timestamp":return i["default"].TIMESTAMP;case"object":return i["default"].OBJECT}return 0}var s=t(e.name,e.value,e.path,e.type,e.description,e.period,e.resolution),c=["boolean","int","number","long","string","date","object"];return{id:e.id,instance:e.repo.instance,definition:s,value:n(e.value,e)}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t["default"]=r},function(e,t,n){"use strict";function r(e){return e.value.constructor===Date||e.type===h["default"].TIMESPAN||e.type===h["default"].TIMESTAMP?"timestamp":"number"==typeof e.value?"number":"string"==typeof e.value||e.type===h["default"].RATE?"string":"object"===m(e.value)?"object":void 0}function o(e){return e.constructor===Date?"timestamp":"number"==typeof e?"number":"string"==typeof e?"string":"object"===(void 0===e?"undefined":m(e))?"object":"string"}function i(e){var t={},n=r(e);if("object"===n){var i=Object.keys(e.value).reduce(function(t,n){var r=o(e.value[n]);if("object"===r){var i=s(e.value[n]);t[n]={type:"object",description:"",context:{},composite:i}}else t[n]={type:r,description:"",context:{}};return t},{});t.composite=i}return t.name=c(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function s(e){return Object.keys(e).reduce(function(t,n){var r=o(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:s(e[n])}:{type:r,description:"",context:{}},t},{})}function c(e){return void 0!==e&&e.length>0&&"/"!==e[0]?"/"+e:e}function u(e){return"timestamp"===r(e)?Date.now():a(e.value)}function a(e){return"object"!==(void 0===e?"undefined":m(e))?e:Object.keys(e).reduce(function(t,n){var r=e[n];return"object"===(void 0===r?"undefined":m(r))&&r.constructor!==Date?t[n]=a(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t},{})}function d(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?d(t):t)},[])}function f(e){return e.sort(function(e,t){return t.state-e.state})[0]}function l(e){var t="";return e.forEach(function(e,n,r){var o=e.path.join(".");t+=n===r.length-1?o+"."+e.name+": "+e.description:o+"."+e.name+": "+e.description+","}),t.length>100?t.slice(0,100)+"...":t}function p(e){var t=e.root.getAggregateState(),n=d(t),r=f(n);return{description:l(n),value:r.state}}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var h=n(0);t.serializeMetric=i,t.normalizeMetricName=c,t.getMetricValueByType=u,t.composeMsgForRootStateMetric=p},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=n(4),s=n(5),c=n(2).version,u="undefined"==typeof window?{}:window;u.tick42=u.tick42||{},t["default"]=function(e){var t={connection:e.connection,identity:e.identity,logger:e.logger,heartbeatInterval:e.heartbeatInterval,settings:{},clickStream:e.clickStream};if(!t.connection||"object"!==r(t.connection))throw new Error("Connection is required parameter");var n;n=3===t.connection.protocolVersion?i["default"](t.connection,e):o["default"](t.connection,e);var u=s["default"](t,n),a=u.root;return a.version=c,a}},function(e,t,n){"use strict";function r(e,t,n,m,h){function g(e,t){if(!e||0===e.length)throw new Error("name is required");var n=J.filter(function(t){return t.name===e});if(n.length>0)return n[0];var o=r(e,P,k,G,t);return J.push(o),o}function y(e,t){q={state:e,description:t},k.updateSystem(G,q)}function v(e,t){return E.call(G,e,p["default"].STRING,t,function(e){return d["default"](e,G,k,t)})}function b(e,t){return E.call(G,e,p["default"].NUMBER,t,function(e){return s["default"](e,G,k,t)})}function S(e,t){return E.call(this,e,p["default"].COUNT,t,function(e){return i["default"](e,G,k,t)})}function _(e,t){return E.call(this,e,p["default"].ADDRESS,t,function(e){return o["default"](e,G,k,t)})}function w(e,t){return E.call(this,e,p["default"].OBJECT,t,function(e){return c["default"](e,G,k,t)})}function j(e,t){return E.call(this,e,p["default"].TIMESPAN,t,function(e){return f["default"](e,G,k,t)})}function M(e,t){return E.call(this,e,p["default"].TIMESTAMP,t,function(e){return l["default"](e,G,k,t)})}function T(e,t){return E.call(this,e,p["default"].RATE,t,function(e){return u["default"](e,G,k,t)})}function I(e,t){return E.call(this,e,p["default"].STATISTICS,t,function(e){return a["default"](e,G,k,t)})}function A(e){var t={};if("string"==typeof e?t.name=e:t=e,t.name===undefined)throw new Error("Metric name is required");return t}function E(e,t,n,r){var o=A(e),i=V.filter(function(e){return e.name===o.name});if(i.length>0){var s=i[0];if(s.type!==t)throw new Error("A metric named "+o.name+" is already defined with different type.");return void 0!==n&&s.update(n),s}var c=r(o);return V.push(c),c}function O(e){if(!e||!e.parent)return[];var t=O(e.parent);return t.push(e.name),t}function N(e,t){return e&&e.length>0?e.join(t):""}function C(){var e=[];return Object.keys(q).length>0&&e.push({name:R,path:F,state:q.state,description:q.description}),J.forEach(function(t){var n=t.getAggregateState();n.length>0&&e.push(n)}),e}if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var k=n,R=e,x=h||"",P=t,D=m,F=O(m),q={},L=N(F,"/")+e,U=t.identity,B=t.root,J=[],V=[],G={get name(){return R},get description(){return x},get repo(){return P},get parent(){return D},path:F,id:L,identity:U,root:B,get subSystems(){return J},get metrics(){return V},subSystem:g,getState:function(){return q},setState:y,stringMetric:v,statisticsMetric:I,rateMetric:T,timestampMetric:M,timespanMetric:j,objectMetric:w,addressMetric:_,countMetric:S,numberMetric:b,getAggregateState:C};return k.createSystem(G),G}Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),i=n(10),s=n(11),c=n(12),u=n(13),a=n(14),d=n(15),f=n(16),l=n(17),p=n(0);t["default"]=r},function(e,t){}])})},function(e,t,n){"use strict";(function(e){function r(t,n){function r(){return{identity:{system:l("metrics","system"),service:l("metrics","service"),instance:l("metrics","instance")}}}function s(){function t(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){}return!1}if(p===undefined){var n=l("gateway"),r=l("gateway","protocolVersion"),o=l("gateway","reconnectInterval"),i=n.ws,s=n.http,c=n.inproc;return i||s||c||(t()||"WebSocket"in window&&2===window.WebSocket.CLOSING?i=l("gateway","ws"):s=l("gateway","http")),{gwTokenProvider:n.gwTokenProvider,identity:{application:a()},reconnectInterval:o,ws:i,http:s,gw:c,protocolVersion:r}}return{}}function c(){return l("logger")}function u(){return{instance:{application:a()}}}function a(){return l("application")}function d(){return l("auth")}function f(){function e(e){var n="undefined"!=typeof document?document.title:"unknown";if(n=n||"none",void 0===p)return{system:"Connect.Browser",service:t.application||n,instance:"~"+e};if("undefined"!=typeof p.metricsFacade.getIdentity){var r=p.metricsFacade.getIdentity();return{system:r.system,service:r.service,instance:r.instance}}return{system:"HtmlContainer."+p.containerName,service:"JS."+p.browserWindowName,instance:"~"+p.machineName}}function n(){function e(e){return!(e&&e<=2)&&("undefined"==typeof window||!window.location||"http:"!==window.location.protocol)}var t=1,n="localhost:22037",r=e(t);return{ws:r?"wss://"+n:"ws://"+n,http:r?"https://"+n:"http://"+n,protocolVersion:t,reconnectInterval:1e3}}function r(e){return p?p.containerName+"."+p.browserWindowName:"undefined"!=typeof window&&"undefined"!=typeof document?(window.agm_application||document.title)+e:"NodeJS"+e}var i=o.generate();return{application:r(i),metrics:e(i),agm:{},gateway:n(),logger:{publish:"off",console:"info",metrics:"off"}}}function l(e,n){var r=m[e],o=t[e],i=h[e],s=g[e];if(n){if(r&&r[n]!==undefined)return m[n];if(o&&o[n]!==undefined)return o[n];if(i&&i[n]!==undefined)return i[n];if(s&&s[n]!==undefined)return s[n]}else{if(r!==undefined)return r;if(o!==undefined)return o;if(i!==undefined)return i;if(s!==undefined)return s}return undefined}var p;"undefined"!=typeof window&&(p=window.htmlContainer,e=e||window),e=e||{};var m=e.GLUE_CONFIG||{},h=e.GLUE_DEFAULT_CONFIG||{},g=f();return{application:a(),auth:d(),logger:c(),connection:s(),metrics:r(),agm:u(),version:n.version||i.version,libs:n.libs}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),i=n(10);t["default"]=r}).call(t,n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={protocolVersion:-1,version:"-1",send:function(e,t,n,r){},on:function(e,t,n){return{type:"1",id:1}},off:function(e){},login:function(e){return undefined},logout:function(){},loggedIn:function(e){},connected:function(e){},disconnected:function(e){}};t["default"]=r},function(e,t,n){"use strict";var r=n(8);"undefined"!=typeof window&&(window.GlueCore=r["default"]),r["default"]["default"]=r["default"],e.exports=r["default"]},function(e,t,n){"use strict";function r(){function e(){return(new Date).getTime()}function t(){return n=e(),r=e()-o}var n,r,o=e();return{get startTime(){return o},get endTime(){return n},get period(){return r},stop:t}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r},function(e,t){}])})},function(e,t,n){var r=n(0),o=n(16),i=n(1),s=r({account:o,contacts:r.Array(i)});e.exports=function(e,t){return{create:function(n){return n=n||{},new Promise(function(r,i){new o(n.account);e.invoke("T42.CRM.CreateAccount",{account:n.account},"all",{method_response_timeout:t.timeout},r,i)})},resolve:function(n){return n=n||{},new Promise(function(r,i){new o(n.account);e.invoke("T42.CRM.ResolveAccount",{account:n.account},"all",{method_response_timeout:t.timeout},r,i)})},update:function(n){return n=n||{},new Promise(function(r,i){var s=(new o(n.account),n.autoCreate);e.invoke("T42.CRM.UpdateAccount",{account:n.account,autoCreate:s},"all",{method_response_timeout:t.timeout},r,i)})},delete:function(n){return n=n||{},new Promise(function(r,i){new o(n.account);e.invoke("T42.CRM.DeleteAccount",{account:n.account},"all",{method_response_timeout:t.timeout},r,i)})},get:function(n){return n=n||{},new Promise(function(r,i){new o(n.account);e.invoke("T42.CRM.GetAccount",{account:n.account},"all",{method_response_timeout:t.timeout},r,i)})},sync:function(n){return n=n||{},new Promise(function(r,i){new o(n.account);e.invoke("T42.CRM.SyncAccount",{account:n.account},"all",{method_response_timeout:t.timeout},r,i)})},resolveContactList:function(n){return n=n||{},new Promise(function(r,o){new s({account:n.account,contacts:n.contacts});e.invoke("T42.CRM.ResolveAccountContactList",{account:n.account,contacts:n.contacts},"all",{method_response_timeout:t.timeout},r,o)})}}}},function(e,t,n){var r=n(1),o=(n(1),n(0)),i=o({contact:r,participants:[o.Array(r)],subject:[String],dueDate:[String],description:[String]});e.exports=function(e,t){return{create:function(n){return n=n||{},new Promise(function(o,i){new r(n.contact);e.invoke("T42.CRM.CreateContact",{contact:n.contact},"all",{method_response_timeout:t.timeout},o,i)})},resolve:function(n){return n=n||{},new Promise(function(o,i){new r(n.contact);e.invoke("T42.CRM.ResolveContact",{contact:n.contact},"all",{method_response_timeout:t.timeout},o,i)})},update:function(n){return n=n||{},new Promise(function(o,i){var s=(new r(n.contact),n.autoCreate);e.invoke("T42.CRM.UpdateContact",{contact:n.contact,autoCreate:s},"all",{method_response_timeout:t.timeout},o,i)})},delete:function(n){return n=n||{},new Promise(function(o,i){new r(n.contact);e.invoke("T42.CRM.DeleteContact",{contact:n.contact},"all",{method_response_timeout:t.timeout},o,i)})},get:function(n){return n=n||{},new Promise(function(o,i){new r(n.contact);e.invoke("T42.CRM.GetContact",{contact:n.contact},"all",{method_response_timeout:t.timeout},o,i)})},sync:function(n){return n=n||{},new Promise(function(o,i){new r(n.contact);e.invoke("T42.CRM.SyncContact",{contact:n.contact},"all",{method_response_timeout:t.timeout},o,i)})},logCall:function(n){return n=n||{},new Promise(function(r,o){var s=new i(n);e.invoke("T42.CRM.LogContactCall",s,"all",{method_response_timeout:t.timeout},r,o)})}}}},function(e,t){var n={name:"T42.Account",properties:[{name:"ids",displayName:"IDs",type:"Composite",isArray:!0,properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"displayName",displayName:"Display Name",type:"String",searchType:"Partial",description:"Display Name"},{name:"owner",displayName:"Owner",type:"Composite",properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"subsidiaries",displayName:"Subsidiaries",type:"Composite",isArray:!0,properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"name",displayName:"Name",type:"String",searchType:"Partial"},{name:"status",displayName:"Status",type:"String",searchType:"Exact",description:"Status"},{name:"contacts",displayName:"Contacts",type:"Composite",isArray:!0,properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"addresses",displayName:"Addresses",type:"Composite",isArray:!0,properties:[{name:"streetAddress",type:"String",displayName:"Street Address",searchType:"Partial"},{name:"city",type:"String",displayName:"City",searchType:"Partial"},{name:"stateOrRegion",type:"String",displayName:"State or Region",searchType:"Partial"},{name:"postalCode",type:"String",displayName:"Postal Code",searchType:"Partial"},{name:"country",type:"String",displayName:"Country",searchType:"Partial"},{name:"description",type:"String",displayName:"Description",searchType:"Partial"}]},{name:"phones",displayName:"Phones",type:"Composite",isArray:!0,properties:[{name:"number",type:"String",displayName:"Number",searchType:"Exact"},{name:"name",type:"String",displayName:"Name",searchType:"Exact"}]},{name:"websites",displayName:"Websites",type:"String",isArray:!0,searchType:"Partial"},{name:"emailDomains",displayName:"Email Domains",type:"String",isArray:!0,searchType:"Partial"},{name:"billingEmailAddress",displayName:"Billing email address",type:"String",searchType:"Partial"}]};e.exports=n},function(e,t){var n={name:"T42.Contact",properties:[{name:"ids",displayName:"IDs",type:"Composite",isArray:!0,properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"displayName",displayName:"Display Name",type:"String",searchType:"Partial",description:"Display Name"},{name:"name",displayName:"Name",type:"Composite",searchType:"Partial",properties:[{name:"companyName",type:"String",displayName:"Company Name",searchType:"Exact"},{name:"lastName",type:"String",displayName:"Last Name",searchType:"Exact"},{name:"firstName",type:"String",displayName:"First Name",searchType:"Exact"},{name:"otherNames",type:"String",displayName:"Other Names",isArray:!0,searchType:"Exact"},{name:"honorific",type:"String",displayName:"Honorific",searchType:"Exact"},{name:"postNominalLetters",type:"String",displayName:"Post-nominal Letters",isArray:!0,searchType:"Exact"}]},{name:"status",displayName:"Status",type:"String",searchType:"Exact",description:"Status"},{name:"isPerson",displayName:"Is Person",type:"Bool",searchType:"Exact",description:"Is Person"},{name:"account",displayName:"Account",type:"Composite",properties:[{name:"nativeId",type:"String",displayName:"Native ID",searchType:"Exact"},{name:"systemName",type:"String",displayName:"System Name",searchType:"Exact"}]},{name:"addresses",displayName:"Addresses",type:"Composite",isArray:!0,properties:[{name:"streetAddress",type:"String",displayName:"Street Address",searchType:"Partial"},{name:"city",type:"String",displayName:"City",searchType:"Partial"},{name:"stateOrRegion",type:"String",displayName:"State or Region",searchType:"Partial"},{name:"postalCode",type:"String",displayName:"Postal Code",searchType:"Partial"},{name:"country",type:"String",displayName:"Country",searchType:"Partial"},{name:"description",type:"String",displayName:"Description",searchType:"Partial"}]},{name:"phones",displayName:"Phones",type:"Composite",isArray:!0,properties:[{name:"number",type:"String",displayName:"Number",searchType:"Exact"},{name:"name",type:"String",displayName:"Name",searchType:"Exact"}]},{name:"emails",displayName:"Emails",type:"String",isArray:!0,searchType:"Partial"}]};e.exports=n},function(e,t,n){var r=n(12),o=n(11);e.exports={"T42.Contact":r,"T42.Account":o}},function(e,t,n){function r(e,t){function n(n,r){return new Promise(function(i,u){if("string"!=typeof n)throw Error("A entity name is required to register a search provider");if(o[n]===undefined)throw Error('Unsupported entity: "'+n+'"');if("function"!=typeof r)throw Error("A search handler is required to register a search provider");s||(s=new gss.GlueSearchProvider(e,{debug:!1,measureLatency:!1,target:{application:t.target}}),c=s.start()),c.then(function(){var e=gss.GssEntityType.fromJS(o[n]);s.addEntityType(e,r),i()})["catch"](u)})}function r(e,t){return new Promise(function(n,r){d.then(function(o){var s=[],c=i&&i.get(e);if(!c)return r("Search provider not found");a.createQuery(c).onData(function(e){s=s.concat(e.entities),e.isLast&&n(s)}).search(t)})["catch"](r)})}var i,s=null,c=null;if(!(t.searchProviders&&t.searchProviders.length>0||t.provider))return{search:function(){console.log("GSS isn't enabled.")},addEntityType:function(){console.log("GSS isn't enabled.")}};if("helper"===t.side&&"undefined"!=typeof gss){var u=gss.createDesktopManager(e,{debug:!1});u.start(),t.searchProviders&&t.searchProviders.length>0&&t.searchProviders.forEach(function(e){u.add({name:e,type:"agm",application:e})});var a=new gss.GlueSearchService(e,{target:{application:t.target}}),d=a.ready();d.then(function(e){e.onEntityTypes(function(e,t){if(e)throw new Error(e);i=t})})}return{addEntityType:n,search:r}}var o=n(13);e.exports=r},function(e,t,n){var r=n(2);e.exports=[{side:"crm",name:r.CRM_PREFIX+"CreateContact",accepts:r.SIGNATURES.CONTACT,description:"",displayName:"Create Contact",objectTypes:[]},{side:"both",name:r.CRM_PREFIX+"GetContact",accepts:r.SIGNATURES.CONTACT,description:"",displayName:"Get Contact",objectTypes:[]},{side:"helper",name:r.CRM_PREFIX+"ResolveContact",accepts:r.SIGNATURES.CONTACT,description:"",displayName:"Resolve Contact",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"UpdateContact",accepts:"Bool? autoCreate, "+r.SIGNATURES.CONTACT,description:"",displayName:"Update Contact",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"DeleteContact",accepts:r.SIGNATURES.CONTACT,description:"",displayName:"Delete Contact",objectTypes:[]},{side:"both",name:r.CRM_PREFIX+"SyncContact",accepts:r.SIGNATURES.CONTACT,description:"",displayName:"Sync Contact",objectTypes:[]},{side:"both",name:r.CRM_PREFIX+"GetAccount",accepts:r.SIGNATURES.ACCOUNT,description:"",displayName:"Get Account",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"CreateAccount",accepts:r.SIGNATURES.ACCOUNT,description:"",displayName:"Create Account",objectTypes:[]},{side:"helper",name:r.CRM_PREFIX+"ResolveAccount",accepts:r.SIGNATURES.ACCOUNT,description:"",displayName:"Resolve Contact",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"UpdateAccount",accepts:"Bool? autoCreate, "+r.SIGNATURES.ACCOUNT,description:"",displayName:"Update Account",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"DeleteAccount",accepts:r.SIGNATURES.ACCOUNT,description:"",displayName:"Delete Account",objectTypes:[]},{side:"both",name:r.CRM_PREFIX+"SyncAccount",accepts:r.SIGNATURES.ACCOUNT,description:"",displayName:"Sync Account",objectTypes:[]},{side:"helper",name:r.CRM_PREFIX+"ResolveAccountContactList",accepts:r.SIGNATURES.CONTACTS+", "+r.SIGNATURES.ACCOUNT,description:"",displayName:"Resolve Account Contact List",objectTypes:[]},{side:"crm",name:r.CRM_PREFIX+"LogContactCall",accepts:"",description:"",displayName:"Log contact call",objectTypes:[]},{side:"both",name:r.CRM_PREFIX+"SearchContact",accepts:"",description:"",displayName:"Search a contact",objectTypes:[]}]},function(e,t,n){var r=n(0),o=n(4),i=n(3),s=n(5);e.exports=r({ids:r.Array(o),displayName:[String],owner:[o],subsidiaries:[r.Array(o)],name:[String],status:[String],contacts:[r.Array(o)],addresses:[r.Array(i)],phones:[r.Array(s)],websites:[r.Array(String)],emailDomains:[r.Array(String)],billingEmailAddress:[String]})},function(e,t,n){var r=n(0);e.exports=r({companyName:[String],lastName:[String],firstName:[String],otherNames:[r.Array(String)],honorific:[String],postNominalLetters:[r.Array(String)]})},function(e,t,n){var r=n(8),o=n(6),i=n(7);e.exports=function(e){var t={side:e.side||o.side,timeout:e.timeout||o.timeout,target:e.application||"GssDesktopManager",searchProviders:e.searchProviders||[],provider:e.provider},n=Object.assign({},o.glue,e);return n.auth=n.authentication,new Promise(function(o,s){var c=void 0;c=e.glue?Promise.resolve(e.glue):r(n),c.then(function(e){o({CRM:i(e.agm,t),glue:e})})["catch"](function(e){s(e)})})}}])});
//# sourceMappingURL=Tick42CRM.js.map